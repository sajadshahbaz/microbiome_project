<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Information Theory and Machine Learning Reveal Synergistic Interactions in Gut Microbiota Related to Food Allergy - data analysis pipeline</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="agp_analysis_public_files/libs/clipboard/clipboard.min.js"></script>
<script src="agp_analysis_public_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="agp_analysis_public_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="agp_analysis_public_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="agp_analysis_public_files/libs/quarto-html/popper.min.js"></script>
<script src="agp_analysis_public_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="agp_analysis_public_files/libs/quarto-html/anchor.min.js"></script>
<link href="agp_analysis_public_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="agp_analysis_public_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="agp_analysis_public_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="agp_analysis_public_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="agp_analysis_public_files/libs/bootstrap/bootstrap-2fdaf46ea063194560002fd0f40a3d88.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Information Theory and Machine Learning Reveal Synergistic Interactions in Gut Microbiota Related to Food Allergy - data analysis pipeline</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(matrixStats)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MDFS)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>randomForest 4.7-1.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type rfNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pROC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggplot2'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:randomForest':

    margin</code></pre>
</div>
</div>
<section id="initial-data-preparation" class="level1">
<h1>Initial data preparation</h1>
<p>Read the raw taxonomy abundance info and metadata from delimiter separated files.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>metadata.filename <span class="ot">&lt;-</span> <span class="st">"metadata.csv"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>taxa.filename <span class="ot">&lt;-</span> <span class="st">"taxa.tsv"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>tdata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">read.delim</span>(taxa.filename, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tdata) <span class="ot">&lt;-</span> tdata[<span class="dv">1</span>,]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>tdata <span class="ot">&lt;-</span> tdata[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>metadata<span class="ot">&lt;-</span><span class="fu">read.csv</span>(metadata.filename, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(metadata)<span class="ot">&lt;-</span>metadata[,<span class="dv">1</span>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>metadata<span class="ot">&lt;-</span>metadata[,<span class="sc">-</span><span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="filtering-of-erroneus-data" class="level2">
<h2 class="anchored" data-anchor-id="filtering-of-erroneus-data">Filtering of erroneus data</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"sex"</span>,<span class="st">"height.cm"</span>,<span class="st">"weight.kg"</span>,<span class="st">"age.years"</span>)<span class="ot">-&gt;</span> confounding_factors</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>confounding_factors <span class="sc">%in%</span> <span class="fu">colnames</span>(metadata)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE TRUE</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>sex[<span class="sc">!</span>(metadata<span class="sc">$</span>sex <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"male"</span>,<span class="st">"female"</span>))]<span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>height[metadata<span class="sc">$</span>height.cm<span class="sc">&lt;</span><span class="dv">38</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>weight[metadata<span class="sc">$</span>weight.kg<span class="sc">&lt;</span><span class="dv">1</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>age_years[metadata<span class="sc">$</span>age.years<span class="sc">&lt;=</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>height[metadata<span class="sc">$</span>height.cm<span class="sc">&gt;</span><span class="dv">220</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>weight[metadata<span class="sc">$</span>weight.kg<span class="sc">&lt;=</span><span class="dv">1</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>weight[metadata<span class="sc">$</span>weight.kg<span class="sc">&gt;</span><span class="dv">200</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>to_remove_mask <span class="ot">&lt;-</span> (metadata[,confounding_factors] <span class="sc">%&gt;%</span> <span class="fu">is.na</span>() <span class="sc">%&gt;%</span> <span class="fu">rowSums</span>()) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>metadata<span class="ot">&lt;-</span>metadata[<span class="sc">!</span>to_remove_mask, ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="taxa-table-preparation" class="level3">
<h3 class="anchored" data-anchor-id="taxa-table-preparation">Taxa table preparation</h3>
<section id="bacteria-selection-and-stool-samples-filtering" class="level4">
<h4 class="anchored" data-anchor-id="bacteria-selection-and-stool-samples-filtering">Bacteria selection and stool samples filtering</h4>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1. skip non bacterial taxa</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tdata<span class="ot">&lt;-</span> tdata[, <span class="fu">grep</span>(<span class="st">'sk__Bacteria'</span>, <span class="fu">colnames</span>(tdata)) ]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"inital number of taxa samples"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "inital number of taxa samples"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">nrow</span>(tdata))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5971</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2. keep stool samples</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>env_material<span class="ot">-&gt;</span> sample_source</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>feces_rownames<span class="ot">&lt;-</span> <span class="fu">rownames</span>(metadata)[ sample_source<span class="sc">==</span><span class="st">"feces"</span> ]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>tdata<span class="ot">&lt;-</span>tdata[ <span class="fu">intersect</span>(<span class="fu">rownames</span>(tdata),feces_rownames),] </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"number of taxa samples from stool"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "number of taxa samples from stool"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">nrow</span>(tdata))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4232</code></pre>
</div>
</div>
</section>
<section id="alpha-diversity-analysis-and-normalization" class="level4">
<h4 class="anchored" data-anchor-id="alpha-diversity-analysis-and-normalization">Alpha diversity analysis and normalization</h4>
<p>Normalize abundancies and use proportions to calculate 3 versions of alpha diversity indexes. Below plots show values of alpha diversity as a function of the rank of cumulative count of each sample. Investigation suggests a common cutoff point, which corresponds to minimum cumulative count of <code>3636</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  t_rownames<span class="ot">&lt;-</span> <span class="fu">rownames</span>(tdata)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  tdata<span class="ot">&lt;-</span> <span class="fu">lapply</span>(tdata, as.numeric) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(tdata)<span class="ot">&lt;-</span> t_rownames</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  lib_sizes<span class="ot">&lt;-</span> <span class="fu">rowSums</span>(tdata) </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  t_props<span class="ot">&lt;-</span>( tdata</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>            )<span class="sc">/</span>lib_sizes <span class="co">#due to R recycling, each row gets divided by its sum</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  shannon_div<span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">rowSums</span>((t_props<span class="fl">+1e-10</span>)<span class="sc">*</span><span class="fu">log</span>(t_props<span class="fl">+1e-10</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  simpson_index<span class="ot">&lt;-</span> <span class="fu">rowSums</span> ( <span class="dv">1</span> <span class="sc">-</span> t_props<span class="sc">^</span><span class="dv">2</span>  )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  inverse_simp<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">rowSums</span>( t_props<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  size_order<span class="ot">&lt;-</span><span class="fu">order</span>(lib_sizes)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  taxa_min_lib_size<span class="ot">=</span> <span class="dv">3636</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  crit_rank<span class="ot">=</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(lib_sizes[size_order] <span class="sc">-</span> taxa_min_lib_size))</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(shannon_div[size_order],<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> crit_rank, <span class="at">col=</span><span class="st">"red"</span>,<span class="at">lwd=</span><span class="dv">2</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/filter1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(simpson_index[size_order],<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> crit_rank, <span class="at">col=</span><span class="st">"red"</span>,<span class="at">lwd=</span><span class="dv">2</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/filter1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(inverse_simp[size_order],<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> crit_rank, <span class="at">col=</span><span class="st">"red"</span>,<span class="at">lwd=</span><span class="dv">2</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/filter1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>  tdata<span class="ot">&lt;-</span> tdata[ <span class="fu">rowSums</span>(tdata) <span class="sc">&gt;=</span> taxa_min_lib_size, ]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  tdata<span class="ot">&lt;-</span> tdata<span class="sc">/</span><span class="fu">rowSums</span>(tdata)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="integrate-two-types-of-information-and-prepare-data-for-base-resampling-procedure" class="level3">
<h3 class="anchored" data-anchor-id="integrate-two-types-of-information-and-prepare-data-for-base-resampling-procedure">Integrate two types of information and prepare data for base resampling procedure</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>common_names<span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">rownames</span>(metadata), <span class="fu">rownames</span>(tdata))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>tdata<span class="ot">&lt;-</span> tdata[common_names,]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>metadata<span class="ot">&lt;-</span>metadata[common_names,]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"# of samples left after filtering by alpha diversity (with repeating donors)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "# of samples left after filtering by alpha diversity (with repeating donors)"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(common_names))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3976</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"# of unique donors"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "# of unique donors"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">length</span>(<span class="fu">unique</span>(metadata<span class="sc">$</span>host.subject.id)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3670</code></pre>
</div>
</div>
</section>
</section>
<section id="median-dataset-and-cohort-summary" class="level2">
<h2 class="anchored" data-anchor-id="median-dataset-and-cohort-summary">Median dataset and cohort summary</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span> metadata<span class="sc">$</span>allergic.to.i.have.no.food.allergies.that.i.know.of </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(y)<span class="ot">&lt;-</span> <span class="fu">rownames</span>(metadata)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>ids<span class="ot">&lt;-</span>metadata<span class="sc">$</span>host.subject.id</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ids)<span class="ot">&lt;-</span><span class="fu">rownames</span>(metadata)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>donors<span class="ot">&lt;-</span><span class="fu">unique</span>(ids)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>taxonomy.mean<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="fu">length</span>(donors),<span class="fu">ncol</span>(tdata))</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(taxonomy.mean)<span class="ot">&lt;-</span>donors</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(taxonomy.mean)<span class="ot">&lt;-</span><span class="fu">colnames</span>(tdata)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>meta.mean<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="fu">length</span>(donors),<span class="dv">6</span>))</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(meta.mean)<span class="ot">&lt;-</span>donors</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(meta.mean)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'age'</span>,<span class="st">'sex'</span>,<span class="st">'weight.kg'</span>,<span class="st">'height.cm'</span>,<span class="st">'BMI_cat'</span>,<span class="st">'age_cat'</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>decision.mean<span class="ot">&lt;-</span><span class="fu">numeric</span>(<span class="fu">length</span>(donors))</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(decision.mean)<span class="ot">&lt;-</span>donors</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"mean_data.RData"</span>)){</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(donors)) {</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a> donor<span class="ot">&lt;-</span>donors[i]</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a> samples<span class="ot">&lt;-</span><span class="fu">names</span>(ids)[ids<span class="sc">==</span>donor]</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a> <span class="co">#decision</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a> decs<span class="ot">&lt;-</span>y[samples]</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a> decision.mean[i]<span class="ot">&lt;-</span><span class="fu">floor</span>(<span class="fu">median</span>(decs))</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a> <span class="co">#taxa</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a> taxa<span class="ot">&lt;-</span>tdata[samples,,drop<span class="ot">=</span>F]</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a> taxonomy.mean[i,]<span class="ot">&lt;-</span><span class="fu">colMedians</span>(<span class="fu">as.matrix</span>(taxa))</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a> <span class="co">#metadata</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a> <span class="co">#age</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a> ages<span class="ot">&lt;-</span>metadata[samples,<span class="st">'age.years'</span>]</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a> ages<span class="ot">&lt;-</span>ages[<span class="sc">!</span><span class="fu">is.na</span>(ages)]</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="fu">length</span>(ages)<span class="sc">&gt;</span><span class="dv">0</span>) meta.mean[i,<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">median</span>(ages))</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a> <span class="co">#sex</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a> sexes<span class="ot">&lt;-</span>metadata[samples,<span class="st">'sex'</span>]</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a> sexes<span class="ot">&lt;-</span>sexes[<span class="sc">!</span><span class="fu">is.na</span>(sexes)]</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="fu">length</span>(sexes)<span class="sc">&gt;</span><span class="dv">0</span>) meta.mean[i,<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="fu">names</span>(<span class="fu">table</span>(sexes))[<span class="fu">which.max</span>(<span class="fu">table</span>(sexes))]</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a> <span class="co">#weight</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a> weights<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(metadata[samples,<span class="st">'weight.kg'</span>])</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a> weights<span class="ot">&lt;-</span>weights[<span class="sc">!</span><span class="fu">is.na</span>(weights)]</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="fu">length</span>(weights)<span class="sc">&gt;</span><span class="dv">0</span>) meta.mean[i,<span class="dv">3</span>]<span class="ot">&lt;-</span><span class="fu">median</span>(weights)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a> <span class="co">#height</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a> heights<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(metadata[samples,<span class="st">'height.cm'</span>])</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a> heights<span class="ot">&lt;-</span>heights[<span class="sc">!</span><span class="fu">is.na</span>(heights)]</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="fu">length</span>(heights)<span class="sc">&gt;</span><span class="dv">0</span>) meta.mean[i,<span class="dv">4</span>]<span class="ot">&lt;-</span><span class="fu">median</span>(heights)</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span>(<span class="sc">!</span>((i<span class="dv">-1</span>)<span class="sc">%%</span><span class="dv">500</span>)) <span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"median data computation... %d / %d done"</span>,i, <span class="fu">length</span>(donors)))</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>mask.meta<span class="ot">&lt;-</span><span class="fu">rowSums</span>(<span class="fu">is.na</span>(meta.mean[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]))<span class="sc">==</span><span class="dv">0</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>meta.mean.final<span class="ot">&lt;-</span>meta.mean[mask.meta,]</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>meta.mean.final[meta.mean.final[<span class="dv">1</span>]<span class="sc">&lt;</span><span class="dv">15</span>,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="st">'0-14'</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>meta.mean.final[meta.mean.final[<span class="dv">1</span>]<span class="sc">&gt;=</span><span class="dv">15</span> <span class="sc">&amp;</span> meta.mean.final[<span class="dv">1</span>]<span class="sc">&lt;</span><span class="dv">64</span>,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="st">'15-64'</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>meta.mean.final[meta.mean.final[<span class="dv">1</span>]<span class="sc">&gt;=</span><span class="dv">64</span>,<span class="dv">6</span>]<span class="ot">&lt;-</span><span class="st">'65+'</span></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>bmi<span class="ot">&lt;-</span>meta.mean.final[,<span class="st">'weight.kg'</span>]<span class="sc">/</span>meta.mean.final[,<span class="st">'height.cm'</span>]<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="dv">10000</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>meta.mean.final[bmi<span class="sc">&lt;</span><span class="fl">18.5</span>,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="st">'Underweight'</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>meta.mean.final[bmi<span class="sc">&gt;=</span><span class="fl">18.5</span> <span class="sc">&amp;</span> bmi<span class="sc">&lt;</span><span class="dv">25</span>,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="st">'Normal'</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>meta.mean.final[bmi<span class="sc">&gt;=</span><span class="dv">25</span> <span class="sc">&amp;</span> bmi<span class="sc">&lt;</span><span class="dv">30</span>,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="st">'Overweight'</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>meta.mean.final[bmi<span class="sc">&gt;=</span><span class="dv">30</span>,<span class="dv">5</span>]<span class="ot">&lt;-</span><span class="st">'Obese'</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>decision.mean.final<span class="ot">&lt;-</span>decision.mean[mask.meta]</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>taxonomy.mean.final<span class="ot">&lt;-</span>taxonomy.mean[mask.meta,]</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>taxonomy.mean.final<span class="ot">&lt;-</span>taxonomy.mean.final[,<span class="fu">colSums</span>(taxonomy.mean.final<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">&gt;</span><span class="dv">20</span>]</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>taxonomy.mean.final<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(taxonomy.mean.final<span class="sc">/</span><span class="fu">rowSums</span>(taxonomy.mean.final)<span class="sc">*</span><span class="dv">10000</span>)</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>binary.mean.final<span class="ot">&lt;-</span>taxonomy.mean.final<span class="sc">*</span><span class="dv">0</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(binary.mean.final)) binary.mean.final[,i]<span class="ot">&lt;-</span>taxonomy.mean.final[,i]<span class="sc">&gt;</span><span class="fu">median</span>(taxonomy.mean.final[,i])</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(meta.mean.final,decision.mean.final,taxonomy.mean.final,binary.mean.final,<span class="at">file=</span><span class="st">'mean_data.RData'</span>)</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {<span class="fu">load</span>(<span class="st">"mean_data.RData"</span>)}</span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="co">#Table 1 </span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(decision.mean.final)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>decision.mean.final
   0    1 
1704 1966 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">0</span>,<span class="dv">2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
female   male 
   906    798 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">1</span>,<span class="dv">2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
female   male 
  1091    875 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(<span class="fu">rbind</span>(<span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">0</span>,<span class="dv">2</span>]),</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">1</span>,<span class="dv">2</span>])))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  rbind(table(meta.mean.final[decision.mean.final == 0, 2]), table(meta.mean.final[decision.mean.final == 1, 2]))
p-value = 0.1629
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
 0.797632 1.039528
sample estimates:
odds ratio 
 0.9105843 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">0</span>,<span class="dv">6</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0-14 15-64   65+ 
   73  1331   300 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">1</span>,<span class="dv">6</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0-14 15-64   65+ 
  125  1552   289 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(<span class="fu">rbind</span>(<span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">0</span>,<span class="dv">6</span>]),</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">1</span>,<span class="dv">6</span>])))<span class="co">#,simulate.p.value = T)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  rbind(table(meta.mean.final[decision.mean.final == 0, 6]), table(meta.mean.final[decision.mean.final == 1, 6]))
p-value = 0.002245
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">0</span>,<span class="dv">5</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Normal       Obese  Overweight Underweight 
        997         167         406         134 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">1</span>,<span class="dv">5</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Normal       Obese  Overweight Underweight 
       1083         287         404         192 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(<span class="fu">rbind</span>(<span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">0</span>,<span class="dv">5</span>]),</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">table</span>(meta.mean.final[decision.mean.final<span class="sc">==</span><span class="dv">1</span>,<span class="dv">5</span>])))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  rbind(table(meta.mean.final[decision.mean.final == 0, 5]), table(meta.mean.final[decision.mean.final == 1, 5]))
p-value = 5.216e-06
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>###Median dataset MDFS for reference</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"FS_functions.R"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>global_MDFS<span class="ot">&lt;-</span><span class="fu">MDFS_FS</span>(<span class="at">X=</span> taxonomy.mean.final,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span> decision.mean.final,<span class="at">lvl =</span> <span class="fl">0.05</span>,<span class="at">seed =</span> <span class="dv">123</span>,<span class="at">mc=</span><span class="dv">30</span>  )</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>global_U<span class="ot">&lt;-</span> <span class="fu">U_test_FS</span>(<span class="at">X=</span>taxonomy.mean.final, <span class="at">y=</span>decision.mean.final, <span class="at">lvl=</span><span class="fl">0.05</span>, <span class="at">min_presence=</span><span class="dv">30</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="subsampling" class="level2">
<h2 class="anchored" data-anchor-id="subsampling">Subsampling</h2>
<p><code>subsamample_donors</code> randomly splits donors into two groups - keep set and leave out group. for each of the donors, one sample is picked at random (some donors have sent more than one sample). Loop repeats this 500 times.</p>
<p>For each of the repeats, we store the sample indicator vector (<code>keep</code> vs <code>leave</code> out group, according to the index in original data).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"subsample_nonrepeating_donors.R"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>host_id<span class="ot">&lt;-</span> metadata<span class="sc">$</span>host.subject.id</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(host_id)<span class="ot">&lt;-</span> <span class="fu">rownames</span>(metadata)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>subsample<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>n_repeats<span class="ot">=</span><span class="dv">500</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"agp_subsamples63.rds"</span>)){</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_repeats){</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(i)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subsample_donors</span>(<span class="at">taxonomy=</span>tdata, <span class="at">disease=</span>y,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">host_id=</span>host_id,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">subsampleSize =</span> <span class="fl">0.63</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">print_summary =</span> <span class="cn">FALSE</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>                   )<span class="ot">-&gt;</span> subsample[[i]]</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (i<span class="sc">%%</span> <span class="dv">50</span><span class="sc">==</span><span class="dv">0</span>) <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"%d/500 done"</span>,i))</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>()</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(subsample, <span class="st">"agp_subsamples63.rds"</span>) </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  subsample<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"agp_subsamples63.rds"</span>)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="feature-selection" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection">Feature selection</h2>
<section id="mdfs" class="level3">
<h3 class="anchored" data-anchor-id="mdfs">MDFS</h3>
<p>Perform discrete variant of MDFS in 1D and 2D mode on each of the prepared base resamples.</p>
<p>whole procedure from discretization up to feature selection is encapsulated in one function <code>MDFS_FS</code>, that performs discrete version of MDFS in 2D and 1D on either of the binarization methods (by zero <code>0</code> or by median <code>m</code>). Respective results are stored in the sublists:</p>
<ul>
<li><code>res_1D0</code>, <code>res_2D0</code>, <code>res_2Dm</code>, <code>res_1Dm</code>.</li>
</ul>
<p>Results include also a set of synergistic partners - taxa that were found to contribute to the information gain of other taxa relevant in 2D analysis, but not relevant by themselves. For practical pruposes, we limit this set by thresholding on increase of IG of the taxa the pure partners were found relevant with, as we go from 1D to 2D statistic. Specifically, we report only those that had increased IG of their 2D relevant partners by at least the minimum value of 1D IG observed among the taxa relevant in 1D.</p>
</section>
<section id="u-test" class="level3">
<h3 class="anchored" data-anchor-id="u-test">U-test</h3>
<p>Similar wrapper was prepared for Wilcoxons test (<code>U_test_FS</code> function). Obviously, we do not have any 2D interactions here.</p>
</section>
<section id="resampling-validation" class="level3">
<h3 class="anchored" data-anchor-id="resampling-validation">Resampling validation</h3>
<p>We validate the results of feature selection by multiple repeats (500) of leave x% out subsampling (jackknife). For each of the subsampled datasets <span class="math inline">\(\mathbf{X^*}, y^*\)</span>, where <span class="math inline">\(\mathbf{X^*}\)</span> are taxa abundances and <span class="math inline">\(y^*\)</span> is the disease status of interest, we perform U-test and MDFS based feature selection. The taxa from the selection procedure are then used to train the random forest classifiers, which are then evaluated on left out data (from this specific realisation of subsampling).</p>
<p>For MDFS analysis, we compare 3 sets of features per repeat:</p>
<ul>
<li>variables relevant in 1D only,</li>
<li>relevant in 2D and 1D,</li>
<li>relevant in 1D and 2D + synergistic partners.</li>
</ul>
<p>We say here that a feature is relevant if it was found by a test based on either of discretization methods, by median or by zero.</p>
<p>Below code executes the validation for both of the procedures (takes around 6h to evaluate). Detailed steps of MDFS pipeline implemented in <code>MDFS_FS()</code> function are described later, using one example repeat of the validation.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>subsample<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"agp_subsamples63.rds"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>n_repeats<span class="ot">=</span><span class="dv">500</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"FS_functions.R"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>features_file_string<span class="ot">=</span><span class="st">"features/agp_features_selected_lop=%.2f.rds"</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>lop<span class="ot">=</span> <span class="fl">0.37</span> <span class="co">#leave out percentage</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#if feature selection was not performed yet, set up the lists</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>fs_fname<span class="ot">=</span><span class="fu">sprintf</span>(features_file_string,lop)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fs_fname)) {</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>features<span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">md1D=</span><span class="fu">list</span>(),</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">md12D=</span><span class="fu">list</span>(),</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">md12Dp=</span><span class="fu">list</span>(),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">u=</span><span class="fu">list</span>()</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> { <span class="co"># otherwise load the saved result</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  features<span class="ot">&lt;-</span><span class="fu">readRDS</span>(fs_fname)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>seeds<span class="ot">=</span> <span class="fu">sample.int</span>(<span class="dv">234234</span>,n_repeats)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>fs_j_pattern<span class="ot">=</span><span class="st">"features/agp_fs_set_j=%d_lop=%.2f.rds"</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a> full_MDFSres<span class="ot">&lt;-</span> full_Ures<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_repeats){</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  fs_j_fname<span class="ot">=</span> <span class="fu">sprintf</span>(fs_j_pattern,j,lop)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fs_j_fname)){</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(fs_j_fname)</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set.seed</span>(seeds[[j]])</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">MDFS_FS</span>(<span class="at">X=</span> tdata[ subsample[[j]]<span class="sc">$</span>keep, ], </span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">y=</span> y[ subsample[[j]]<span class="sc">$</span>keep ], <span class="at">lvl=</span><span class="fl">0.05</span>, <span class="at">p.adjust.method =</span> <span class="st">"holm"</span>,</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">seed=</span> seeds[[j]],</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">mc=</span><span class="dv">30</span> <span class="co">#minimum allowed class size of binarized taxa abundance</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>              )<span class="ot">-&gt;</span> all_mdfs_j</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">U_test_FS</span>(<span class="at">X=</span>tdata[ subsample[[j]]<span class="sc">$</span>keep, ],</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> y[ subsample[[j]]<span class="sc">$</span>keep ],</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">lvl =</span> <span class="fl">0.05</span>,</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">p.adjust.method =</span> <span class="st">"holm"</span>,</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">min_presence=</span><span class="dv">30</span>)<span class="ot">-&gt;</span>u_j</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>      fs_j<span class="ot">=</span><span class="fu">list</span>(<span class="at">mdfs=</span>all_mdfs_j, <span class="at">u=</span>u_j)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(fs_j, fs_j_fname)</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>        fs_j<span class="ot">=</span><span class="fu">readRDS</span>(fs_j_fname)</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>        all_mdfs_j<span class="ot">=</span>fs_j<span class="sc">$</span>mdfs</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>        u_j<span class="ot">=</span>fs_j<span class="sc">$</span>u</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  full_MDFSres[[j]]<span class="ot">=</span>all_mdfs_j</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>  full_Ures[[j]]<span class="ot">=</span>u_j</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>  (<span class="sc">!</span><span class="fu">file.exists</span>(features_file_string)) {</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>            features<span class="sc">$</span>u[[j]]<span class="ot">=</span>u_j<span class="sc">$</span>rel_set</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>            features<span class="sc">$</span>md1D[[j]]<span class="ot">=</span><span class="fu">union</span>(all_mdfs_j<span class="sc">$</span>res_1Dm<span class="sc">$</span>rel_set, all_mdfs_j<span class="sc">$</span>res_1D0<span class="sc">$</span>rel_set)</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>            features<span class="sc">$</span>md12D[[j]]<span class="ot">=</span><span class="fu">Reduce</span>(union, <span class="fu">list</span>(all_mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>rel_set, </span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>                                                  all_mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>rel_set,</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>                                                  features<span class="sc">$</span>md1D[[j]]))</span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>            features<span class="sc">$</span>md12Dp[[j]]<span class="ot">=</span><span class="fu">Reduce</span>(union, <span class="fu">list</span>(all_mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>partner_set, </span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>                                                  all_mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>partner_set,</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>                                                  features<span class="sc">$</span>md12D[[j]]))</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>  model_file_string<span class="ot">=</span><span class="st">"RF_models/agp_j=%d_fs=%s_lop=%.2f.rds"</span></span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (fs_method <span class="cf">in</span> <span class="fu">c</span>(<span class="fu">names</span>(features),<span class="st">"md12DpInt"</span> )){</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>    fname<span class="ot">=</span><span class="fu">sprintf</span>(model_file_string,j,fs_method,lop)</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(fname)</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set.seed</span>(seeds[[j]])</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>      RF_fs_j<span class="ot">=</span><span class="cn">NA</span> <span class="co"># set NA by default, immediately replaced by resulting model if</span></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># fs_method found anything</span></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>      f_key<span class="ot">&lt;-</span> <span class="cf">if</span> (fs_method<span class="sc">==</span><span class="st">"md12DpInt"</span>) <span class="st">"md12Dp"</span> <span class="cf">else</span> fs_method</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(features[[f_key]][[j]])) {</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>      X_keep<span class="ot">&lt;-</span>tdata[ subsample[[j]]<span class="sc">$</span>keep, ,</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>                                      drop<span class="ot">=</span><span class="cn">FALSE</span></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>                                      ]</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>      X_keep_sel<span class="ot">&lt;-</span> X_keep[, features[[f_key]][[j]], drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>      X_rf<span class="ot">&lt;-</span> X_keep_sel</span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (fs_method<span class="sc">==</span><span class="st">"md12DpInt"</span>)</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>              <span class="co">#if any true synergies were found, interaction_data has length == 4</span></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="fu">length</span>(full_MDFSres[[j]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>interaction_data)<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>                    interaction_xm<span class="ot">&lt;-</span> <span class="fu">generate_interaction_variables</span>(X_keep, full_MDFSres[[j]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>interaction_data)</span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>                    X_rf<span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_rf, interaction_xm)</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>              } </span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (<span class="fu">length</span>(full_MDFSres[[j]]<span class="sc">$</span>res_2D0<span class="sc">$</span>interaction_data)<span class="sc">&gt;</span><span class="dv">1</span>) {</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>                  interaction_x0<span class="ot">&lt;-</span> <span class="fu">generate_interaction_variables</span>(X_keep, full_MDFSres[[j]]<span class="sc">$</span>res_2D0<span class="sc">$</span>interaction_data) </span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>                  X_rf<span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_rf, interaction_x0)</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>              } </span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>      y_rf<span class="ot">&lt;-</span>  y[   subsample[[j]]<span class="sc">$</span>keep ] <span class="sc">|&gt;</span> <span class="fu">as.factor</span>() </span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>      RF_fs_j<span class="ot">=</span> <span class="fu">randomForest</span>(<span class="at">x=</span> X_rf,</span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y=</span> y_rf)</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(RF_fs_j, <span class="at">file=</span>fname)                      </span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a>    <span class="co">#RF_models[[fs_method]][[j]]=RF_fs_j</span></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"%d /%d done"</span>,j,n_repeats))</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>1 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>3 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>4 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>5 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>6 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>7 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>8 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>9 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>10 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>11 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>12 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>13 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>14 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>15 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>16 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>17 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>18 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>19 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>20 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>21 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>22 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>23 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>24 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>25 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>26 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>27 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>28 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>29 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>30 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>31 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>32 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>33 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>34 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>35 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>36 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>37 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>38 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>39 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>40 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>41 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>42 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>43 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>44 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>45 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>46 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>47 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>48 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>49 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>50 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>51 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>52 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>53 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>54 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>55 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>56 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>57 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>58 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>59 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>60 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>61 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>62 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>63 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>64 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>65 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>66 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>67 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>68 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>69 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>70 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>71 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>72 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>73 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>74 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>75 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>76 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>77 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>78 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>79 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>80 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>81 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>82 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>83 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>84 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>85 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>86 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>87 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>88 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>89 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>90 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>91 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>92 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>93 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>94 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>95 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>96 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>97 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>98 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>99 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>101 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>102 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>103 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>104 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>105 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>106 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>107 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>108 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>109 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>110 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>111 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>112 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>113 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>114 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>115 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>116 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>117 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>118 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>119 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>120 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>121 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>122 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>123 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>124 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>125 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>126 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>127 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>128 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>129 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>130 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>131 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>132 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>133 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>134 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>135 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>136 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>137 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>138 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>139 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>140 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>141 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>142 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>143 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>144 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>145 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>146 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>147 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>148 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>149 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>150 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>151 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>152 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>153 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>154 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>155 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>156 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>157 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>158 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>159 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>160 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>161 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>162 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>163 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>164 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>165 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>166 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>167 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>168 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>169 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>170 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>171 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>172 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>173 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>174 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>175 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>176 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>177 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>178 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>179 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>180 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>181 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>182 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>183 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>184 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>185 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>186 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>187 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>188 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>189 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>190 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>191 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>192 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>193 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>194 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>195 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>196 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>197 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>198 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>199 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>200 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>201 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>202 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>203 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>204 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>205 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>206 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>207 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>208 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>209 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>210 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>211 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>212 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>213 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>214 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>215 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>216 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>217 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>218 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>219 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>220 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>221 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>222 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>223 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>224 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>225 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>226 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>227 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>228 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>229 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>230 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>231 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>232 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>233 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>234 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>235 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>236 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>237 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>238 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>239 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>240 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>241 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>242 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>243 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>244 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>245 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>246 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>247 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>248 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>249 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>250 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>251 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>252 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>253 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>254 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>255 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>256 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>257 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>258 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>259 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>260 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>261 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>262 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>263 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>264 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>265 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>266 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>267 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>268 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>269 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>270 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>271 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>272 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>273 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>274 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>275 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>276 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>277 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>278 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>279 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>280 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>281 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>282 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>283 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>284 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>285 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>286 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>287 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>288 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>289 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>290 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>291 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>292 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>293 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>294 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>295 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>296 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>297 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>298 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>299 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>300 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>301 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>302 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>303 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>304 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>305 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>306 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>307 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>308 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>309 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>310 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>311 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>312 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>313 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>314 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>315 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>316 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>317 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>318 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>319 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>320 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>321 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>322 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>323 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>324 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>325 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>326 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>327 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>328 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>329 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>330 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>331 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>332 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>333 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>334 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>335 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>336 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>337 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>338 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>339 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>340 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>341 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>342 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>343 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>344 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>345 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>346 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>347 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>348 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>349 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>350 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>351 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>352 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>353 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>354 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>355 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>356 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>357 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>358 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>359 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>360 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>361 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>362 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>363 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>364 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>365 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>366 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>367 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>368 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>369 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>370 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>371 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>372 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>373 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>374 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>375 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>376 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>377 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>378 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>379 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>380 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>381 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>382 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>383 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>384 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>385 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>386 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>387 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>388 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>389 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>390 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>391 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>392 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>393 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>394 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>395 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>396 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>397 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>398 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>399 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>400 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>401 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>402 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>403 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>404 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>405 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>406 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>407 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>408 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>409 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>410 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>411 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>412 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>413 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>414 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>415 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>416 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>417 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>418 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>419 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>420 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>421 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>422 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>423 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>424 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>425 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>426 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>427 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>428 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>429 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>430 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>431 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>432 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>433 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>434 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>435 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>436 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>437 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>438 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>439 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>440 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>441 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>442 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>443 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>444 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>445 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>446 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>447 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>448 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>449 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>450 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>451 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>452 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>453 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>454 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>455 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>456 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>457 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>458 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>459 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>460 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>461 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>462 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>463 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>464 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>465 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>466 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>467 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>468 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>469 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>470 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>471 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>472 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>473 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>474 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>475 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>476 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>477 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>478 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>479 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>480 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>481 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>482 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>483 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>484 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>485 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>486 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>487 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>488 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>489 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>490 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>491 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>492 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>493 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>494 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>495 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>496 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>497 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>498 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>499 /500 done</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>500 /500 done</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb558"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a>n_repeats<span class="ot">=</span><span class="dv">500</span></span>
<span id="cb558-2"><a href="#cb558-2" aria-hidden="true" tabindex="-1"></a><span class="co">#n_repeats=30</span></span>
<span id="cb558-3"><a href="#cb558-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"balanced_decision.R"</span>)</span>
<span id="cb558-4"><a href="#cb558-4" aria-hidden="true" tabindex="-1"></a>METHODS<span class="ot">=</span><span class="fu">c</span>(<span class="fu">names</span>(features))</span>
<span id="cb558-5"><a href="#cb558-5" aria-hidden="true" tabindex="-1"></a>METRICS<span class="ot">=</span><span class="fu">c</span>(<span class="st">"AUC"</span>,<span class="st">"OR"</span>)</span>
<span id="cb558-6"><a href="#cb558-6" aria-hidden="true" tabindex="-1"></a>odds_ratio<span class="ot">&lt;-</span> <span class="cf">function</span>(y_pred, y){</span>
<span id="cb558-7"><a href="#cb558-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># if(length(unique(y_pred))&lt;2){</span></span>
<span id="cb558-8"><a href="#cb558-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(sprintf("bad table %s %s",method, cohort));</span></span>
<span id="cb558-9"><a href="#cb558-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  return(1)}</span></span>
<span id="cb558-10"><a href="#cb558-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y))<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb558-11"><a href="#cb558-11" aria-hidden="true" tabindex="-1"></a>  CM<span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb558-12"><a href="#cb558-12" aria-hidden="true" tabindex="-1"></a>  CM[<span class="dv">1</span>,<span class="dv">1</span>]<span class="ot">=</span><span class="fu">sum</span>( (y_pred<span class="sc">==</span><span class="dv">0</span>) <span class="sc">&amp;</span> (y<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb558-13"><a href="#cb558-13" aria-hidden="true" tabindex="-1"></a>  CM[<span class="dv">2</span>,<span class="dv">1</span>]<span class="ot">=</span><span class="fu">sum</span>( (y_pred<span class="sc">==</span><span class="dv">1</span>) <span class="sc">&amp;</span> (y<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb558-14"><a href="#cb558-14" aria-hidden="true" tabindex="-1"></a>  CM[<span class="dv">1</span>,<span class="dv">2</span>]<span class="ot">=</span><span class="fu">sum</span>( (y_pred<span class="sc">==</span><span class="dv">0</span>) <span class="sc">&amp;</span> (y<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb558-15"><a href="#cb558-15" aria-hidden="true" tabindex="-1"></a>  CM[<span class="dv">2</span>,<span class="dv">2</span>]<span class="ot">=</span><span class="fu">sum</span>( (y_pred<span class="sc">==</span><span class="dv">1</span>) <span class="sc">&amp;</span> (y<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb558-16"><a href="#cb558-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(CM<span class="sc">==</span><span class="dv">0</span>)) CM<span class="ot">=</span> CM <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb558-17"><a href="#cb558-17" aria-hidden="true" tabindex="-1"></a>  (CM[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">*</span>CM[<span class="dv">1</span>,<span class="dv">1</span>])<span class="sc">/</span>(CM[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>CM[<span class="dv">2</span>,<span class="dv">1</span>])</span>
<span id="cb558-18"><a href="#cb558-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb558-19"><a href="#cb558-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"performance_agp.rds"</span>)) {</span>
<span id="cb558-20"><a href="#cb558-20" aria-hidden="true" tabindex="-1"></a>performance<span class="ot">=</span><span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">length</span>(METHODS),<span class="fu">length</span>(METRICS), n_repeats),</span>
<span id="cb558-21"><a href="#cb558-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb558-22"><a href="#cb558-22" aria-hidden="true" tabindex="-1"></a>                                  METHODS,</span>
<span id="cb558-23"><a href="#cb558-23" aria-hidden="true" tabindex="-1"></a>                                  METRICS,</span>
<span id="cb558-24"><a href="#cb558-24" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">NULL</span>  <span class="co">#500 repeats</span></span>
<span id="cb558-25"><a href="#cb558-25" aria-hidden="true" tabindex="-1"></a>                                  )</span>
<span id="cb558-26"><a href="#cb558-26" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb558-27"><a href="#cb558-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-28"><a href="#cb558-28" aria-hidden="true" tabindex="-1"></a>pred_thr<span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="at">dim=</span> <span class="fu">c</span>( <span class="fu">length</span>(METHODS),n_repeats),</span>
<span id="cb558-29"><a href="#cb558-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dimnames =</span> <span class="fu">list</span>(</span>
<span id="cb558-30"><a href="#cb558-30" aria-hidden="true" tabindex="-1"></a>                                  METHODS,</span>
<span id="cb558-31"><a href="#cb558-31" aria-hidden="true" tabindex="-1"></a>                                  <span class="cn">NULL</span>  <span class="co">#500 repeats</span></span>
<span id="cb558-32"><a href="#cb558-32" aria-hidden="true" tabindex="-1"></a>                                  )</span>
<span id="cb558-33"><a href="#cb558-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb558-34"><a href="#cb558-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-35"><a href="#cb558-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_repeats){</span>
<span id="cb558-36"><a href="#cb558-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method <span class="cf">in</span> METHODS){</span>
<span id="cb558-37"><a href="#cb558-37" aria-hidden="true" tabindex="-1"></a>    fname<span class="ot">=</span><span class="fu">sprintf</span>(model_file_string,j,method,lop)</span>
<span id="cb558-38"><a href="#cb558-38" aria-hidden="true" tabindex="-1"></a>  RF_mj<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fname)</span>
<span id="cb558-39"><a href="#cb558-39" aria-hidden="true" tabindex="-1"></a>  no_features<span class="ot">&lt;-</span> (<span class="fu">length</span>(RF_mj)<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb558-40"><a href="#cb558-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (no_features){ </span>
<span id="cb558-41"><a href="#cb558-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"null %s %s"</span>,method))</span>
<span id="cb558-42"><a href="#cb558-42" aria-hidden="true" tabindex="-1"></a>      performance[method,<span class="st">"AUC"</span>,j]<span class="ot">=</span><span class="fl">0.5</span></span>
<span id="cb558-43"><a href="#cb558-43" aria-hidden="true" tabindex="-1"></a>      performance[method,<span class="st">"OR"</span>,j]<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb558-44"><a href="#cb558-44" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb558-45"><a href="#cb558-45" aria-hidden="true" tabindex="-1"></a>    f_key<span class="ot">=</span> <span class="cf">if</span> (method <span class="sc">%in%</span> <span class="fu">names</span>(features)) method <span class="cf">else</span> <span class="st">"md12Dp"</span></span>
<span id="cb558-46"><a href="#cb558-46" aria-hidden="true" tabindex="-1"></a>    X_test<span class="ot">&lt;-</span> tdata[ subsample[[j]]<span class="sc">$</span>leave, ,drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb558-47"><a href="#cb558-47" aria-hidden="true" tabindex="-1"></a>    X_rf<span class="ot">&lt;-</span> X_test[, features[[f_key]][[j]], drop<span class="ot">=</span><span class="cn">FALSE</span> ]</span>
<span id="cb558-48"><a href="#cb558-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (method<span class="sc">==</span><span class="st">"md12DpInt"</span>){</span>
<span id="cb558-49"><a href="#cb558-49" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(full_MDFSres[[j]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>interaction_data)<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb558-50"><a href="#cb558-50" aria-hidden="true" tabindex="-1"></a>                    interaction_xm<span class="ot">&lt;-</span> <span class="fu">generate_interaction_variables</span>(X_test, full_MDFSres[[j]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>interaction_data)</span>
<span id="cb558-51"><a href="#cb558-51" aria-hidden="true" tabindex="-1"></a>                    X_rf<span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_rf, interaction_xm)</span>
<span id="cb558-52"><a href="#cb558-52" aria-hidden="true" tabindex="-1"></a>              } </span>
<span id="cb558-53"><a href="#cb558-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(full_MDFSres[[j]]<span class="sc">$</span>res_2D0<span class="sc">$</span>interaction_data)<span class="sc">&gt;</span><span class="dv">1</span>){</span>
<span id="cb558-54"><a href="#cb558-54" aria-hidden="true" tabindex="-1"></a>                    interaction_x0<span class="ot">&lt;-</span> <span class="fu">generate_interaction_variables</span>(X_test, full_MDFSres[[j]]<span class="sc">$</span>res_2D0<span class="sc">$</span>interaction_data)</span>
<span id="cb558-55"><a href="#cb558-55" aria-hidden="true" tabindex="-1"></a>                    X_rf<span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_rf, interaction_x0)</span>
<span id="cb558-56"><a href="#cb558-56" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb558-57"><a href="#cb558-57" aria-hidden="true" tabindex="-1"></a>    X_rf_ref<span class="ot">&lt;-</span>X_rf</span>
<span id="cb558-58"><a href="#cb558-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb558-59"><a href="#cb558-59" aria-hidden="true" tabindex="-1"></a>    test_pred<span class="ot">=</span> <span class="fu">predict</span>(RF_mj, <span class="at">newdata=</span>  X_rf,</span>
<span id="cb558-60"><a href="#cb558-60" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type=</span><span class="st">"prob"</span>  )[,<span class="dv">2</span>]</span>
<span id="cb558-61"><a href="#cb558-61" aria-hidden="true" tabindex="-1"></a>    y_thr<span class="ot">=</span> <span class="fu">balanced.decision</span>(<span class="at">x =</span> RF_mj<span class="sc">$</span>votes[,<span class="dv">2</span>], </span>
<span id="cb558-62"><a href="#cb558-62" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y=</span> y[   subsample[[j]]<span class="sc">$</span>keep ] )<span class="sc">$</span>threshold</span>
<span id="cb558-63"><a href="#cb558-63" aria-hidden="true" tabindex="-1"></a>    pred_thr[method,j]<span class="ot">=</span>y_thr</span>
<span id="cb558-64"><a href="#cb558-64" aria-hidden="true" tabindex="-1"></a>    y_pbin<span class="ot">&lt;-</span> (test_pred <span class="sc">&gt;=</span> y_thr)</span>
<span id="cb558-65"><a href="#cb558-65" aria-hidden="true" tabindex="-1"></a>    confusion<span class="ot">=</span><span class="fu">table</span>(<span class="at">Predicted=</span>y_pbin,<span class="at">Actual=</span> y[   subsample[[j]]<span class="sc">$</span>leave ] )</span>
<span id="cb558-66"><a href="#cb558-66" aria-hidden="true" tabindex="-1"></a>    performance[method,<span class="st">"AUC"</span>,j]<span class="ot">=</span> <span class="fu">auc</span>(<span class="at">response=</span>y[   subsample[[j]]<span class="sc">$</span>leave ],</span>
<span id="cb558-67"><a href="#cb558-67" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">predictor=</span>test_pred,<span class="at">quiet=</span><span class="cn">TRUE</span>)<span class="sc">|&gt;</span> <span class="fu">as.numeric</span>() </span>
<span id="cb558-68"><a href="#cb558-68" aria-hidden="true" tabindex="-1"></a>    performance[method,<span class="st">"OR"</span>,j]<span class="ot">=</span>  <span class="fu">odds_ratio</span>(y_pbin, y[   subsample[[j]]<span class="sc">$</span>leave ])</span>
<span id="cb558-69"><a href="#cb558-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb558-70"><a href="#cb558-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb558-71"><a href="#cb558-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb558-72"><a href="#cb558-72" aria-hidden="true" tabindex="-1"></a>  j_<span class="ot">=</span> j<span class="dv">-1</span></span>
<span id="cb558-73"><a href="#cb558-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j_<span class="sc">==</span><span class="dv">0</span>) <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="st">"_"</span>,n_repeats <span class="sc">%/%</span> <span class="dv">10</span>),<span class="at">collapse=</span><span class="st">""</span>))</span>
<span id="cb558-74"><a href="#cb558-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((j_<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">&amp;&amp;</span> (j_ <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>)) <span class="fu">cat</span>(<span class="st">"#"</span>)</span>
<span id="cb558-75"><a href="#cb558-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb558-76"><a href="#cb558-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-77"><a href="#cb558-77" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb558-78"><a href="#cb558-78" aria-hidden="true" tabindex="-1"></a>  performance<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"performance_agp.rds"</span>)</span>
<span id="cb558-79"><a href="#cb558-79" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="overall-performance-median-dataset-roc-curve" class="level5">
<h5 class="anchored" data-anchor-id="overall-performance-median-dataset-roc-curve">Overall performance (median dataset ROC curve)</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb559"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a>METHODxROC<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a>AUCxROC<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a>CONFxMETHOD<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a>ORxMETHOD<span class="ot">=</span><span class="fu">list</span>()</span>
<span id="cb559-5"><a href="#cb559-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-6"><a href="#cb559-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">644545</span>)</span>
<span id="cb559-7"><a href="#cb559-7" aria-hidden="true" tabindex="-1"></a>seeds_glob<span class="ot">=</span><span class="fu">sample.int</span>(<span class="dv">213212</span>,<span class="dv">4</span>,<span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb559-8"><a href="#cb559-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(seeds_glob)<span class="ot">=</span> METHODS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb559-9"><a href="#cb559-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (METHOD <span class="cf">in</span> METHODS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]){</span>
<span id="cb559-10"><a href="#cb559-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (METHOD<span class="sc">==</span><span class="st">'u'</span>) sel_feats<span class="ot">&lt;-</span> global_U<span class="sc">$</span>rel_set</span>
<span id="cb559-11"><a href="#cb559-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (METHOD<span class="sc">==</span><span class="st">'md1D'</span>) sel_feats<span class="ot">&lt;-</span> <span class="fu">union</span>(global_MDFS<span class="sc">$</span>res_1Dm<span class="sc">$</span>rel_set, </span>
<span id="cb559-12"><a href="#cb559-12" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_1D0<span class="sc">$</span>rel_set) </span>
<span id="cb559-13"><a href="#cb559-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (METHOD<span class="sc">==</span><span class="st">'md12D'</span>) sel_feats<span class="ot">&lt;-</span> <span class="fu">Reduce</span>(union, <span class="fu">list</span>(global_MDFS<span class="sc">$</span>res_2Dm<span class="sc">$</span>rel_set, </span>
<span id="cb559-14"><a href="#cb559-14" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_1Dm<span class="sc">$</span>rel_set, </span>
<span id="cb559-15"><a href="#cb559-15" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_1D0<span class="sc">$</span>rel_set, </span>
<span id="cb559-16"><a href="#cb559-16" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_2D0<span class="sc">$</span>rel_set)) </span>
<span id="cb559-17"><a href="#cb559-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (METHOD<span class="sc">==</span><span class="st">'md12Dp'</span>) sel_feats<span class="ot">&lt;-</span> <span class="fu">Reduce</span>(union,<span class="fu">list</span>(global_MDFS<span class="sc">$</span>res_2Dm<span class="sc">$</span>rel_set, </span>
<span id="cb559-18"><a href="#cb559-18" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_1Dm<span class="sc">$</span>rel_set, </span>
<span id="cb559-19"><a href="#cb559-19" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_1D0<span class="sc">$</span>rel_set, </span>
<span id="cb559-20"><a href="#cb559-20" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_2D0<span class="sc">$</span>rel_set,</span>
<span id="cb559-21"><a href="#cb559-21" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_2D0<span class="sc">$</span>partner_set,</span>
<span id="cb559-22"><a href="#cb559-22" aria-hidden="true" tabindex="-1"></a>                    global_MDFS<span class="sc">$</span>res_2Dm<span class="sc">$</span>partner_set</span>
<span id="cb559-23"><a href="#cb559-23" aria-hidden="true" tabindex="-1"></a>                    )) </span>
<span id="cb559-24"><a href="#cb559-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-25"><a href="#cb559-25" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(seeds_glob[[METHOD]])</span>
<span id="cb559-26"><a href="#cb559-26" aria-hidden="true" tabindex="-1"></a>RF_mdl<span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="at">x=</span>taxonomy.mean.final[,sel_feats],</span>
<span id="cb559-27"><a href="#cb559-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">y=</span> decision.mean.final <span class="sc">|&gt;</span> <span class="fu">as.factor</span>() )</span>
<span id="cb559-28"><a href="#cb559-28" aria-hidden="true" tabindex="-1"></a>    y_thr<span class="ot">=</span> <span class="fu">balanced.decision</span>(<span class="at">x =</span> RF_mdl<span class="sc">$</span>votes[,<span class="dv">2</span>],</span>
<span id="cb559-29"><a href="#cb559-29" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y=</span> decision.mean.final )<span class="sc">$</span>threshold</span>
<span id="cb559-30"><a href="#cb559-30" aria-hidden="true" tabindex="-1"></a>    y_pbin<span class="ot">&lt;-</span> (RF_mdl<span class="sc">$</span>votes[,<span class="dv">2</span>] <span class="sc">&gt;=</span> y_thr)</span>
<span id="cb559-31"><a href="#cb559-31" aria-hidden="true" tabindex="-1"></a>    CONFxMETHOD[[METHOD]]<span class="ot">=</span><span class="fu">table</span>(<span class="at">Predicted=</span><span class="fu">as.numeric</span>(y_pbin),<span class="at">Actual=</span> decision.mean.final)</span>
<span id="cb559-32"><a href="#cb559-32" aria-hidden="true" tabindex="-1"></a>    ORxMETHOD[[METHOD]]<span class="ot">=</span><span class="fu">odds_ratio</span>(<span class="at">y_pred =</span> y_pbin,<span class="at">y =</span> decision.mean.final)</span>
<span id="cb559-33"><a href="#cb559-33" aria-hidden="true" tabindex="-1"></a>    roc_curve<span class="ot">=</span><span class="fu">roc</span>(<span class="at">response=</span>decision.mean.final,</span>
<span id="cb559-34"><a href="#cb559-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">predictor=</span>RF_mdl<span class="sc">$</span>votes[,<span class="dv">2</span>],<span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb559-35"><a href="#cb559-35" aria-hidden="true" tabindex="-1"></a>METHODxROC[[METHOD]]<span class="ot">=</span> roc_curve</span>
<span id="cb559-36"><a href="#cb559-36" aria-hidden="true" tabindex="-1"></a>AUCxROC[[METHOD]]<span class="ot">=</span> <span class="fu">auc</span>(roc_curve)</span>
<span id="cb559-37"><a href="#cb559-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb559-38"><a href="#cb559-38" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(METHODxROC)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MDFS-1D"</span>,<span class="st">"MDFS-2D"</span>, <span class="st">"MDFS-2D + partners"</span>, <span class="st">"U-test"</span>)</span>
<span id="cb559-39"><a href="#cb559-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb559-40"><a href="#cb559-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_nm <span class="cf">in</span> <span class="fu">seq_along</span>(<span class="fu">names</span>(METHODxROC)))</span>
<span id="cb559-41"><a href="#cb559-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_nm2 <span class="cf">in</span> <span class="fu">seq_along</span>(<span class="fu">names</span>(METHODxROC)))</span>
<span id="cb559-42"><a href="#cb559-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i_nm<span class="sc">&lt;</span>i_nm2) { nm<span class="ot">&lt;-</span> <span class="fu">names</span>(METHODxROC)[[i_nm]]; nm2<span class="ot">&lt;-</span> <span class="fu">names</span>(METHODxROC)[[i_nm2]] </span>
<span id="cb559-43"><a href="#cb559-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"%s vs %s"</span>, nm,nm2))</span>
<span id="cb559-44"><a href="#cb559-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">roc.test</span>(METHODxROC[[nm]], METHODxROC[[nm2]]))</span>
<span id="cb559-45"><a href="#cb559-45" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MDFS-1D vs MDFS-2D"

    DeLong's test for two correlated ROC curves

data:  METHODxROC[[nm]] and METHODxROC[[nm2]]
Z = -2.806, p-value = 0.005017
alternative hypothesis: true difference in AUC is not equal to 0
95 percent confidence interval:
 -0.018854541 -0.003346826
sample estimates:
AUC of roc1 AUC of roc2 
  0.7234278   0.7345285 

[1] "MDFS-1D vs MDFS-2D + partners"

    DeLong's test for two correlated ROC curves

data:  METHODxROC[[nm]] and METHODxROC[[nm2]]
Z = -3.5414, p-value = 0.000398
alternative hypothesis: true difference in AUC is not equal to 0
95 percent confidence interval:
 -0.023027561 -0.006619634
sample estimates:
AUC of roc1 AUC of roc2 
  0.7234278   0.7382514 

[1] "MDFS-1D vs U-test"

    DeLong's test for two correlated ROC curves

data:  METHODxROC[[nm]] and METHODxROC[[nm2]]
Z = 0.74289, p-value = 0.4575
alternative hypothesis: true difference in AUC is not equal to 0
95 percent confidence interval:
 -0.004728925  0.010501949
sample estimates:
AUC of roc1 AUC of roc2 
  0.7234278   0.7205413 

[1] "MDFS-2D vs MDFS-2D + partners"

    DeLong's test for two correlated ROC curves

data:  METHODxROC[[nm]] and METHODxROC[[nm2]]
Z = -1.0812, p-value = 0.2796
alternative hypothesis: true difference in AUC is not equal to 0
95 percent confidence interval:
 -0.010471890  0.003026062
sample estimates:
AUC of roc1 AUC of roc2 
  0.7345285   0.7382514 

[1] "MDFS-2D vs U-test"

    DeLong's test for two correlated ROC curves

data:  METHODxROC[[nm]] and METHODxROC[[nm2]]
Z = 3.0321, p-value = 0.002429
alternative hypothesis: true difference in AUC is not equal to 0
95 percent confidence interval:
 0.004945676 0.023028715
sample estimates:
AUC of roc1 AUC of roc2 
  0.7345285   0.7205413 

[1] "MDFS-2D + partners vs U-test"

    DeLong's test for two correlated ROC curves

data:  METHODxROC[[nm]] and METHODxROC[[nm2]]
Z = 3.7533, p-value = 0.0001745
alternative hypothesis: true difference in AUC is not equal to 0
95 percent confidence interval:
 0.008461945 0.026958273
sample estimates:
AUC of roc1 AUC of roc2 
  0.7382514   0.7205413 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb561"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(METHODxROC)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_along</span>(METHODxROC),</span>
<span id="cb561-2"><a href="#cb561-2" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">function</span>(m)</span>
<span id="cb561-3"><a href="#cb561-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">sprintf</span>(<span class="st">"%s, AUC=%.2f"</span>,</span>
<span id="cb561-4"><a href="#cb561-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">names</span>(METHODxROC)[[m]],</span>
<span id="cb561-5"><a href="#cb561-5" aria-hidden="true" tabindex="-1"></a>                                     AUCxROC[[m]]))</span>
<span id="cb561-6"><a href="#cb561-6" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb561-7"><a href="#cb561-7" aria-hidden="true" tabindex="-1"></a><span class="co">#pdf("roc_curve_v2.pdf", width=8,height=5)</span></span>
<span id="cb561-8"><a href="#cb561-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(METHODxROC, <span class="at">legacy.axes =</span> T,<span class="at">aes=</span><span class="fu">c</span>(<span class="st">"color"</span>),<span class="at">lwd=</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb561-9"><a href="#cb561-9" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span> ,<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>) <span class="sc">+</span> <span class="co"># add identity line</span></span>
<span id="cb561-10"><a href="#cb561-10" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb561-11"><a href="#cb561-11" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb561-12"><a href="#cb561-12" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">18</span>, <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb561-13"><a href="#cb561-13" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">18</span>, <span class="at">face =</span> <span class="st">'bold'</span>),</span>
<span id="cb561-14"><a href="#cb561-14" aria-hidden="true" tabindex="-1"></a><span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb561-15"><a href="#cb561-15" aria-hidden="true" tabindex="-1"></a><span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span><span class="st">'bold'</span>),</span>
<span id="cb561-16"><a href="#cb561-16" aria-hidden="true" tabindex="-1"></a><span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span><span class="st">'bold'</span>)) <span class="sc">+</span></span>
<span id="cb561-17"><a href="#cb561-17" aria-hidden="true" tabindex="-1"></a><span class="fu">xlab</span>(<span class="st">'100% - Specificity'</span>) <span class="sc">+</span></span>
<span id="cb561-18"><a href="#cb561-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">'Sensitivity'</span>) <span class="sc">+</span></span>
<span id="cb561-19"><a href="#cb561-19" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.25</span>), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.25</span>) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb561-20"><a href="#cb561-20" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.25</span>), <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.25</span>) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb561-21"><a href="#cb561-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Feature Selection + RF: ROC comparison"</span>) <span class="sc">+</span><span class="co"># theme(legend.position = "left")</span></span>
<span id="cb561-22"><a href="#cb561-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"FS method"</span>) <span class="sc">+</span></span>
<span id="cb561-23"><a href="#cb561-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">lwd =</span> <span class="dv">5</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.
 Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for x is already present.
Adding another scale for x, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/roc-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb564"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb564-1"><a href="#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> METHODS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]){</span>
<span id="cb564-2"><a href="#cb564-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(m)</span>
<span id="cb564-3"><a href="#cb564-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(CONFxMETHOD[[m]])</span>
<span id="cb564-4"><a href="#cb564-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"OR=%.3f "</span>,ORxMETHOD[[m]]))</span>
<span id="cb564-5"><a href="#cb564-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "md1D"
         Actual
Predicted    0    1
        0 1080  620
        1  624 1346
[1] "OR=3.757 "
[1] "md12D"
         Actual
Predicted    0    1
        0 1105  597
        1  599 1369
[1] "OR=4.230 "
[1] "md12Dp"
         Actual
Predicted    0    1
        0 1101  602
        1  603 1364
[1] "OR=4.137 "
[1] "u"
         Actual
Predicted    0    1
        0 1078  622
        1  626 1344
[1] "OR=3.721 "</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb566"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb566-1"><a href="#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb567"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  model_file_string="RF_models/agp_j=%d_fs=%s_lop=%.2f.rds"</span></span>
<span id="cb567-2"><a href="#cb567-2" aria-hidden="true" tabindex="-1"></a><span class="co">#global_MDFS&lt;-MDFS_FS(X= taxonomy.mean.final,</span></span>
<span id="cb567-3"><a href="#cb567-3" aria-hidden="true" tabindex="-1"></a><span class="co">#        y= decision.mean.final,lvl = 0.05,seed = 123,mc=30  )</span></span>
<span id="cb567-4"><a href="#cb567-4" aria-hidden="true" tabindex="-1"></a><span class="co">#global_U&lt;- U_test_FS(X=taxonomy.mean.final, y=decision.mean.final, lvl=0.05, min_presence=30)</span></span>
<span id="cb567-5"><a href="#cb567-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb567-6"><a href="#cb567-6" aria-hidden="true" tabindex="-1"></a><span class="co">#set.seed(644545)</span></span>
<span id="cb567-7"><a href="#cb567-7" aria-hidden="true" tabindex="-1"></a><span class="co">#r=sample.int(n_repeats,size = 1)</span></span>
<span id="cb567-8"><a href="#cb567-8" aria-hidden="true" tabindex="-1"></a><span class="co">#print(r)</span></span>
<span id="cb567-9"><a href="#cb567-9" aria-hidden="true" tabindex="-1"></a><span class="co">#METHODxROC=list()</span></span>
<span id="cb567-10"><a href="#cb567-10" aria-hidden="true" tabindex="-1"></a><span class="co">#AUCxROC=list()</span></span>
<span id="cb567-11"><a href="#cb567-11" aria-hidden="true" tabindex="-1"></a><span class="co">#CONFxMETHOD=list()</span></span>
<span id="cb567-12"><a href="#cb567-12" aria-hidden="true" tabindex="-1"></a><span class="co">#ORxMETHOD=list()</span></span>
<span id="cb567-13"><a href="#cb567-13" aria-hidden="true" tabindex="-1"></a><span class="co">#for (METHOD in METHODS[1:4]){</span></span>
<span id="cb567-14"><a href="#cb567-14" aria-hidden="true" tabindex="-1"></a><span class="co">#fname=sprintf(model_file_string,r,METHOD,lop)</span></span>
<span id="cb567-15"><a href="#cb567-15" aria-hidden="true" tabindex="-1"></a><span class="co">#RF_mdl&lt;- readRDS(fname)</span></span>
<span id="cb567-16"><a href="#cb567-16" aria-hidden="true" tabindex="-1"></a><span class="co">#no_features&lt;- (length(RF_mdl)==1)</span></span>
<span id="cb567-17"><a href="#cb567-17" aria-hidden="true" tabindex="-1"></a><span class="co">#stopifnot(!no_features)</span></span>
<span id="cb567-18"><a href="#cb567-18" aria-hidden="true" tabindex="-1"></a><span class="co">#    f_key= if (METHOD %in% names(features)) METHOD else "md12Dp"</span></span>
<span id="cb567-19"><a href="#cb567-19" aria-hidden="true" tabindex="-1"></a><span class="co">#    X_test&lt;- tdata[ subsample[[r]]$leave, ,drop=FALSE]</span></span>
<span id="cb567-20"><a href="#cb567-20" aria-hidden="true" tabindex="-1"></a><span class="co">#    X_rf&lt;- X_test[, features[[f_key]][[r]], drop=FALSE ]</span></span>
<span id="cb567-21"><a href="#cb567-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    test_pred= predict(RF_mdl, newdata=  X_rf,</span></span>
<span id="cb567-22"><a href="#cb567-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                      type="prob"  )[,2]</span></span>
<span id="cb567-23"><a href="#cb567-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    y_thr= balanced.decision(x = RF_mdl$votes[,2],</span></span>
<span id="cb567-24"><a href="#cb567-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                             y= y[   subsample[[r]]$keep ] )$threshold</span></span>
<span id="cb567-25"><a href="#cb567-25" aria-hidden="true" tabindex="-1"></a><span class="co">#    y_pbin&lt;- (test_pred &gt;= y_thr)</span></span>
<span id="cb567-26"><a href="#cb567-26" aria-hidden="true" tabindex="-1"></a><span class="co">#    CONFxMETHOD[[METHOD]]==table(Predicted=as.numeric(y_pbin),Actual= y[   subsample[[r]]$leave ] )</span></span>
<span id="cb567-27"><a href="#cb567-27" aria-hidden="true" tabindex="-1"></a><span class="co">#    ORxMETHOD[[METHOD]]=odds_ratio(y_pred = y_pbin,y = y[ subsample[[r]]$leave])</span></span>
<span id="cb567-28"><a href="#cb567-28" aria-hidden="true" tabindex="-1"></a><span class="co">#    roc_curve=roc(response=y[   subsample[[r]]$leave ],</span></span>
<span id="cb567-29"><a href="#cb567-29" aria-hidden="true" tabindex="-1"></a><span class="co">#        predictor=test_pred,quiet=TRUE)</span></span>
<span id="cb567-30"><a href="#cb567-30" aria-hidden="true" tabindex="-1"></a><span class="co">#METHODxROC[[METHOD]]= roc_curve</span></span>
<span id="cb567-31"><a href="#cb567-31" aria-hidden="true" tabindex="-1"></a><span class="co">#AUCxROC[[METHOD]]= auc(roc_curve)</span></span>
<span id="cb567-32"><a href="#cb567-32" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb567-33"><a href="#cb567-33" aria-hidden="true" tabindex="-1"></a><span class="co">#names(METHODxROC)&lt;- c("MDFS-1D","MDFS-2D", "MDFS-2D + partners", "U-test")</span></span>
<span id="cb567-34"><a href="#cb567-34" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb567-35"><a href="#cb567-35" aria-hidden="true" tabindex="-1"></a><span class="co">#for (i_nm in seq_along(names(METHODxROC)))</span></span>
<span id="cb567-36"><a href="#cb567-36" aria-hidden="true" tabindex="-1"></a><span class="co">#  for (i_nm2 in seq_along(names(METHODxROC)))</span></span>
<span id="cb567-37"><a href="#cb567-37" aria-hidden="true" tabindex="-1"></a><span class="co">#    if (i_nm&lt;i_nm2) { nm&lt;- names(METHODxROC)[[i_nm]]; nm2&lt;- names(METHODxROC)[[i_nm2]] </span></span>
<span id="cb567-38"><a href="#cb567-38" aria-hidden="true" tabindex="-1"></a><span class="co">#      print(sprintf("%s vs %s", nm,nm2))</span></span>
<span id="cb567-39"><a href="#cb567-39" aria-hidden="true" tabindex="-1"></a><span class="co">#    print(roc.test(METHODxROC[[nm]], METHODxROC[[nm2]]))</span></span>
<span id="cb567-40"><a href="#cb567-40" aria-hidden="true" tabindex="-1"></a><span class="co">#    }</span></span>
<span id="cb567-41"><a href="#cb567-41" aria-hidden="true" tabindex="-1"></a><span class="co">#names(METHODxROC)&lt;- sapply(seq_along(METHODxROC),</span></span>
<span id="cb567-42"><a href="#cb567-42" aria-hidden="true" tabindex="-1"></a><span class="co">#                           function(m)</span></span>
<span id="cb567-43"><a href="#cb567-43" aria-hidden="true" tabindex="-1"></a><span class="co">#                             sprintf("%s, AUC=%.2f",</span></span>
<span id="cb567-44"><a href="#cb567-44" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     names(METHODxROC)[[m]],</span></span>
<span id="cb567-45"><a href="#cb567-45" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     AUCxROC[[m]]))</span></span>
<span id="cb567-46"><a href="#cb567-46" aria-hidden="true" tabindex="-1"></a><span class="co">#         </span></span>
<span id="cb567-47"><a href="#cb567-47" aria-hidden="true" tabindex="-1"></a><span class="do">##pdf("roc_curve_v2.pdf", width=8,height=5)</span></span>
<span id="cb567-48"><a href="#cb567-48" aria-hidden="true" tabindex="-1"></a><span class="co">#ggroc(METHODxROC, legacy.axes = T,aes=c("color"),lwd=0.75) +</span></span>
<span id="cb567-49"><a href="#cb567-49" aria-hidden="true" tabindex="-1"></a><span class="co">#geom_abline(slope = 1 ,intercept = 0, linetype="dashed") + # add identity line</span></span>
<span id="cb567-50"><a href="#cb567-50" aria-hidden="true" tabindex="-1"></a><span class="co">#theme(</span></span>
<span id="cb567-51"><a href="#cb567-51" aria-hidden="true" tabindex="-1"></a><span class="co">#panel.background = element_blank(),</span></span>
<span id="cb567-52"><a href="#cb567-52" aria-hidden="true" tabindex="-1"></a><span class="co">#axis.title.x = element_text(size =18, face = 'bold'),</span></span>
<span id="cb567-53"><a href="#cb567-53" aria-hidden="true" tabindex="-1"></a><span class="co">#axis.title.y = element_text(size =18, face = 'bold'),</span></span>
<span id="cb567-54"><a href="#cb567-54" aria-hidden="true" tabindex="-1"></a><span class="co">#panel.border = element_rect(size = 2, fill = NA),</span></span>
<span id="cb567-55"><a href="#cb567-55" aria-hidden="true" tabindex="-1"></a><span class="co">#axis.text.x = element_text(size = 14, face ='bold'),</span></span>
<span id="cb567-56"><a href="#cb567-56" aria-hidden="true" tabindex="-1"></a><span class="co">#axis.text.y = element_text(size = 14, face ='bold')) +</span></span>
<span id="cb567-57"><a href="#cb567-57" aria-hidden="true" tabindex="-1"></a><span class="co">#xlab('100% - Specificity') +</span></span>
<span id="cb567-58"><a href="#cb567-58" aria-hidden="true" tabindex="-1"></a><span class="co">#ylab('Sensitivity') +</span></span>
<span id="cb567-59"><a href="#cb567-59" aria-hidden="true" tabindex="-1"></a><span class="co">#scale_x_continuous(breaks = seq(0,1,0.25), labels = seq(0,1,0.25) * 100) +</span></span>
<span id="cb567-60"><a href="#cb567-60" aria-hidden="true" tabindex="-1"></a><span class="co">#scale_y_continuous(breaks = seq(0,1,0.25), labels = seq(0,1,0.25) * 100) +</span></span>
<span id="cb567-61"><a href="#cb567-61" aria-hidden="true" tabindex="-1"></a><span class="co">#  ggtitle("Feature Selection + RF: ROC comparison") +# theme(legend.position = "left")</span></span>
<span id="cb567-62"><a href="#cb567-62" aria-hidden="true" tabindex="-1"></a><span class="co">#  scale_color_discrete(name = "FS method") +</span></span>
<span id="cb567-63"><a href="#cb567-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   guides(color = guide_legend(override.aes = list(lwd = 5)))</span></span>
<span id="cb567-64"><a href="#cb567-64" aria-hidden="true" tabindex="-1"></a><span class="do">##dev.off()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="synthetic-variables-test-chinese-paper-doesnt-work" class="level6">
<h6 class="anchored" data-anchor-id="synthetic-variables-test-chinese-paper-doesnt-work">Synthetic variables test (chinese paper (doesnt work))</h6>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb568"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb568-1"><a href="#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pairs&lt;-rbind(</span></span>
<span id="cb568-2"><a href="#cb568-2" aria-hidden="true" tabindex="-1"></a><span class="co">#cbind(full_MDFSres[[r]]$res_2Dm$interaction_data$rel_name,</span></span>
<span id="cb568-3"><a href="#cb568-3" aria-hidden="true" tabindex="-1"></a><span class="co">#full_MDFSres[[r]]$res_2Dm$interaction_data$partner_name),</span></span>
<span id="cb568-4"><a href="#cb568-4" aria-hidden="true" tabindex="-1"></a><span class="co">#cbind(full_MDFSres[[r]]$res_2D0$interaction_data$rel_name,</span></span>
<span id="cb568-5"><a href="#cb568-5" aria-hidden="true" tabindex="-1"></a><span class="co">#full_MDFSres[[r]]$res_2D0$interaction_data$partner_name))</span></span>
<span id="cb568-6"><a href="#cb568-6" aria-hidden="true" tabindex="-1"></a><span class="co">#METHOD="md12pInt"</span></span>
<span id="cb568-7"><a href="#cb568-7" aria-hidden="true" tabindex="-1"></a><span class="co">#    f_key= if (METHOD %in% names(features)) METHOD else "md12Dp"</span></span>
<span id="cb568-8"><a href="#cb568-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    X_test&lt;- tdata[ subsample[[r]]$leave, ,drop=FALSE]</span></span>
<span id="cb568-9"><a href="#cb568-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    X_train&lt;- tdata[ subsample[[r]]$keep, ,drop=FALSE]</span></span>
<span id="cb568-10"><a href="#cb568-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    X_rf_train&lt;- X_train[, features[[f_key]][[r]], drop=FALSE ]</span></span>
<span id="cb568-11"><a href="#cb568-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    X_rf_test&lt;- X_test[, features[[f_key]][[r]], drop=FALSE ]</span></span>
<span id="cb568-12"><a href="#cb568-12" aria-hidden="true" tabindex="-1"></a><span class="co">#synthetic_variables&lt;- function(data, pairs, pairwise_fun){</span></span>
<span id="cb568-13"><a href="#cb568-13" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(pairs,1,function(ROW) pairwise_fun(rank(data[, ROW[[1]] ]), rank(data[, ROW[[2]] ])),</span></span>
<span id="cb568-14"><a href="#cb568-14" aria-hidden="true" tabindex="-1"></a><span class="co">#       simplify=FALSE) |&gt; as.data.frame()</span></span>
<span id="cb568-15"><a href="#cb568-15" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb568-16"><a href="#cb568-16" aria-hidden="true" tabindex="-1"></a><span class="co">#S_trainPlus&lt;-synthetic_variables(X_rf_train, pairs,function(x,y) x+y)</span></span>
<span id="cb568-17"><a href="#cb568-17" aria-hidden="true" tabindex="-1"></a><span class="co">#S_trainDiff&lt;-synthetic_variables(X_rf_train, pairs,function(x,y) x-y)</span></span>
<span id="cb568-18"><a href="#cb568-18" aria-hidden="true" tabindex="-1"></a><span class="co">#S_trainProd&lt;-synthetic_variables(X_rf_train, pairs,function(x,y) x*y)</span></span>
<span id="cb568-19"><a href="#cb568-19" aria-hidden="true" tabindex="-1"></a><span class="co">#S_trainSgn&lt;-synthetic_variables(X_rf_train, pairs,function(x,y)  x&gt;y)</span></span>
<span id="cb568-20"><a href="#cb568-20" aria-hidden="true" tabindex="-1"></a><span class="co">#S_trainAbs&lt;-synthetic_variables(X_rf_train, pairs,function(x,y)  abs(x-y))</span></span>
<span id="cb568-21"><a href="#cb568-21" aria-hidden="true" tabindex="-1"></a><span class="co">#X_rf_trainPlus&lt;- cbind(X_rf_train,S_trainPlus)</span></span>
<span id="cb568-22"><a href="#cb568-22" aria-hidden="true" tabindex="-1"></a><span class="co">#X_rf_trainDiff&lt;- cbind(X_rf_train,S_trainDiff)</span></span>
<span id="cb568-23"><a href="#cb568-23" aria-hidden="true" tabindex="-1"></a><span class="co">#X_rf_trainProd&lt;- cbind(X_rf_train,S_trainProd)</span></span>
<span id="cb568-24"><a href="#cb568-24" aria-hidden="true" tabindex="-1"></a><span class="co">#X_rf_trainSgn&lt;- cbind(X_rf_train,S_trainSgn)</span></span>
<span id="cb568-25"><a href="#cb568-25" aria-hidden="true" tabindex="-1"></a><span class="co">#X_rf_trainAbs&lt;- cbind(X_rf_train,S_trainAbs)</span></span>
<span id="cb568-26"><a href="#cb568-26" aria-hidden="true" tabindex="-1"></a><span class="co">#X_rf_trainAll&lt;- cbind(X_rf_train, S_trainPlus,</span></span>
<span id="cb568-27"><a href="#cb568-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                      S_trainDiff,</span></span>
<span id="cb568-28"><a href="#cb568-28" aria-hidden="true" tabindex="-1"></a><span class="co">#                      S_trainProd,</span></span>
<span id="cb568-29"><a href="#cb568-29" aria-hidden="true" tabindex="-1"></a><span class="co">#                      S_trainSgn,</span></span>
<span id="cb568-30"><a href="#cb568-30" aria-hidden="true" tabindex="-1"></a><span class="co">#                      S_trainAbs)</span></span>
<span id="cb568-31"><a href="#cb568-31" aria-hidden="true" tabindex="-1"></a><span class="co">#message("rfs...")</span></span>
<span id="cb568-32"><a href="#cb568-32" aria-hidden="true" tabindex="-1"></a><span class="co">#rf_plus&lt;- randomForest(x= X_rf_trainPlus,</span></span>
<span id="cb568-33"><a href="#cb568-33" aria-hidden="true" tabindex="-1"></a><span class="co">#                       y= y[ subsample[[r]]$keep ] |&gt; as.factor() )</span></span>
<span id="cb568-34"><a href="#cb568-34" aria-hidden="true" tabindex="-1"></a><span class="co">#cat("x")</span></span>
<span id="cb568-35"><a href="#cb568-35" aria-hidden="true" tabindex="-1"></a><span class="co">#rf_diff&lt;- randomForest(x= X_rf_trainDiff,</span></span>
<span id="cb568-36"><a href="#cb568-36" aria-hidden="true" tabindex="-1"></a><span class="co">#                       y= y[ subsample[[r]]$keep ] |&gt; as.factor() )</span></span>
<span id="cb568-37"><a href="#cb568-37" aria-hidden="true" tabindex="-1"></a><span class="co">#cat("x")</span></span>
<span id="cb568-38"><a href="#cb568-38" aria-hidden="true" tabindex="-1"></a><span class="co">#rf_prod&lt;- randomForest(x= X_rf_trainProd,</span></span>
<span id="cb568-39"><a href="#cb568-39" aria-hidden="true" tabindex="-1"></a><span class="co">#                       y= y[ subsample[[r]]$keep ] |&gt; as.factor() )</span></span>
<span id="cb568-40"><a href="#cb568-40" aria-hidden="true" tabindex="-1"></a><span class="co">#cat("x")</span></span>
<span id="cb568-41"><a href="#cb568-41" aria-hidden="true" tabindex="-1"></a><span class="co">#rf_sgn&lt;- randomForest(x= X_rf_trainSgn,</span></span>
<span id="cb568-42"><a href="#cb568-42" aria-hidden="true" tabindex="-1"></a><span class="co">#                       y= y[ subsample[[r]]$keep ] |&gt; as.factor())</span></span>
<span id="cb568-43"><a href="#cb568-43" aria-hidden="true" tabindex="-1"></a><span class="co">#cat("x")</span></span>
<span id="cb568-44"><a href="#cb568-44" aria-hidden="true" tabindex="-1"></a><span class="co">#rf_abs&lt;- randomForest(x= X_rf_trainAbs,</span></span>
<span id="cb568-45"><a href="#cb568-45" aria-hidden="true" tabindex="-1"></a><span class="co">#                       y= y[ subsample[[r]]$keep ] |&gt; as.factor())</span></span>
<span id="cb568-46"><a href="#cb568-46" aria-hidden="true" tabindex="-1"></a><span class="co">#cat("x")</span></span>
<span id="cb568-47"><a href="#cb568-47" aria-hidden="true" tabindex="-1"></a><span class="co">#rf_all&lt;- randomForest(x= X_rf_trainAll,</span></span>
<span id="cb568-48"><a href="#cb568-48" aria-hidden="true" tabindex="-1"></a><span class="co">#                       y= y[ subsample[[r]]$keep ] |&gt; as.factor())</span></span>
<span id="cb568-49"><a href="#cb568-49" aria-hidden="true" tabindex="-1"></a><span class="co">#cat("x")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb569"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: synthetic_auc</span></span>
<span id="cb569-2"><a href="#cb569-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| dependson: synthetic</span></span>
<span id="cb569-3"><a href="#cb569-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb569-4"><a href="#cb569-4" aria-hidden="true" tabindex="-1"></a><span class="co">#auc_from_rf&lt;- function(rf,y_train){</span></span>
<span id="cb569-5"><a href="#cb569-5" aria-hidden="true" tabindex="-1"></a><span class="co"># as.numeric( auc(response=y_train, predictor= rf$votes[,2]))</span></span>
<span id="cb569-6"><a href="#cb569-6" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb569-7"><a href="#cb569-7" aria-hidden="true" tabindex="-1"></a><span class="co">#print("Synethetic models performace:")</span></span>
<span id="cb569-8"><a href="#cb569-8" aria-hidden="true" tabindex="-1"></a><span class="co">#print(auc_from_rf(rf=rf_plus, y_train = y[ subsample[[r]]$keep ] ))</span></span>
<span id="cb569-9"><a href="#cb569-9" aria-hidden="true" tabindex="-1"></a><span class="co">#print(auc_from_rf(rf=rf_diff, y_train = y[ subsample[[r]]$keep ] ))</span></span>
<span id="cb569-10"><a href="#cb569-10" aria-hidden="true" tabindex="-1"></a><span class="co">#print(auc_from_rf(rf=rf_prod, y_train = y[ subsample[[r]]$keep ] ))</span></span>
<span id="cb569-11"><a href="#cb569-11" aria-hidden="true" tabindex="-1"></a><span class="co">#print(auc_from_rf(rf=rf_sgn, y_train = y[ subsample[[r]]$keep ] ))</span></span>
<span id="cb569-12"><a href="#cb569-12" aria-hidden="true" tabindex="-1"></a><span class="co">#print(auc_from_rf(rf=rf_abs, y_train = y[ subsample[[r]]$keep ] ))</span></span>
<span id="cb569-13"><a href="#cb569-13" aria-hidden="true" tabindex="-1"></a><span class="co">#print(auc_from_rf(rf=rf_all, y_train = y[ subsample[[r]]$keep ] ))</span></span>
<span id="cb569-14"><a href="#cb569-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="aggregate-performance-calculation-and-visualization" class="level6">
<h6 class="anchored" data-anchor-id="aggregate-performance-calculation-and-visualization">Aggregate performance calculation and visualization</h6>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb570"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb570-1"><a href="#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"performance_agp.rds"</span>)) <span class="fu">saveRDS</span>(performance, <span class="st">"performance_agp.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb571"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("reshape2")</span></span>
<span id="cb571-2"><a href="#cb571-2" aria-hidden="true" tabindex="-1"></a>long_perf <span class="ot">&lt;-</span> <span class="fu">melt</span>(performance, </span>
<span id="cb571-3"><a href="#cb571-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">"Method"</span>, <span class="st">"Metric"</span>, <span class="st">"Repeat"</span>), <span class="at">value.name =</span> <span class="st">"Value"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb572"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb572-1"><a href="#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("dplyr")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb573"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("ggplot2")</span></span>
<span id="cb573-2"><a href="#cb573-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary_lines &lt;- long_perf %&gt;%</span></span>
<span id="cb573-3"><a href="#cb573-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  group_by(Metric, Method) %&gt;%</span></span>
<span id="cb573-4"><a href="#cb573-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  summarise(</span></span>
<span id="cb573-5"><a href="#cb573-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    median = median(Value),</span></span>
<span id="cb573-6"><a href="#cb573-6" aria-hidden="true" tabindex="-1"></a><span class="co">#    notch_lower = quantile(Value, 0.25) + 1.57 * IQR(Value) / sqrt(n()),</span></span>
<span id="cb573-7"><a href="#cb573-7" aria-hidden="true" tabindex="-1"></a><span class="co">#    notch_upper = quantile(Value, 0.75) - 1.57 * IQR(Value) / sqrt(n()),</span></span>
<span id="cb573-8"><a href="#cb573-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    .groups = "drop"</span></span>
<span id="cb573-9"><a href="#cb573-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  )</span></span>
<span id="cb573-10"><a href="#cb573-10" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(long_perf<span class="sc">$</span>Method) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MDFS-1D"</span>, <span class="st">"MDFS-2D"</span>, <span class="st">"MDFS-2D + partners"</span>, <span class="st">"U-test"</span>, <span class="st">"md12DpInt"</span>)</span>
<span id="cb573-11"><a href="#cb573-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-12"><a href="#cb573-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Violin plot to show distribution</span></span>
<span id="cb573-13"><a href="#cb573-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(long_perf[long_perf<span class="sc">$</span>Method<span class="sc">!=</span><span class="st">"md12DpInt"</span>,], <span class="fu">aes</span>(<span class="at">x =</span> Method, <span class="at">y =</span> Value, <span class="at">fill =</span> Method)) <span class="sc">+</span></span>
<span id="cb573-14"><a href="#cb573-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_violin(trim = FALSE, alpha = 0.7) +</span></span>
<span id="cb573-15"><a href="#cb573-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">notch =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb573-16"><a href="#cb573-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">#geom_hline(data = summary_lines, aes(yintercept = median, color = Method), linetype = "solid") +</span></span>
<span id="cb573-17"><a href="#cb573-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-18"><a href="#cb573-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add dashed lines for notches</span></span>
<span id="cb573-19"><a href="#cb573-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_hline(data = summary_lines, aes(yintercept = notch_lower, color = Method), linetype = "dashed") +</span></span>
<span id="cb573-20"><a href="#cb573-20" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_hline(data = summary_lines, aes(yintercept = notch_upper, color = Method), linetype = "dashed") +</span></span>
<span id="cb573-21"><a href="#cb573-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>  <span class="co"># Separate plots for AUC and OR</span></span>
<span id="cb573-22"><a href="#cb573-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme_minimal() +</span></span>
<span id="cb573-23"><a href="#cb573-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"Performance Metric Distributions by Method, l.o.frac= %.2f"</span>,lop),</span>
<span id="cb573-24"><a href="#cb573-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Value"</span>, <span class="at">x =</span> <span class="st">"Feature Selection Method"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb573-25"><a href="#cb573-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>, <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/plot_perf-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="selection-partnership-frequency-calculation-and-visualization" class="level6">
<h6 class="anchored" data-anchor-id="selection-partnership-frequency-calculation-and-visualization">Selection &amp; partnership frequency calculation and visualization</h6>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb574"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb574-1"><a href="#cb574-1" aria-hidden="true" tabindex="-1"></a>universe<span class="ot">&lt;-</span> <span class="fu">colnames</span>(tdata)</span>
<span id="cb574-2"><a href="#cb574-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-3"><a href="#cb574-3" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(rbind,</span>
<span id="cb574-4"><a href="#cb574-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lapply</span>(features, <span class="cf">function</span>(method_repeats)</span>
<span id="cb574-5"><a href="#cb574-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">Reduce</span>(<span class="st">"+"</span>, <span class="fu">lapply</span>(method_repeats, <span class="cf">function</span>(one_repeat_of_a_method) </span>
<span id="cb574-6"><a href="#cb574-6" aria-hidden="true" tabindex="-1"></a>                                                    universe <span class="sc">%in%</span> one_repeat_of_a_method </span>
<span id="cb574-7"><a href="#cb574-7" aria-hidden="true" tabindex="-1"></a>                                                    ),</span>
<span id="cb574-8"><a href="#cb574-8" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb574-9"><a href="#cb574-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb574-10"><a href="#cb574-10" aria-hidden="true" tabindex="-1"></a>        )<span class="ot">-&gt;</span> feature_absence_presence</span>
<span id="cb574-11"><a href="#cb574-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-12"><a href="#cb574-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feature_absence_presence)<span class="ot">&lt;-</span>universe</span>
<span id="cb574-13"><a href="#cb574-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-14"><a href="#cb574-14" aria-hidden="true" tabindex="-1"></a>frequent_<span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">over95=</span> .<span class="dv">95</span><span class="sc">*</span>n_repeats, <span class="at">over90=</span>.<span class="dv">9</span><span class="sc">*</span>n_repeats)</span>
<span id="cb574-15"><a href="#cb574-15" aria-hidden="true" tabindex="-1"></a>feature_absence_presence[, <span class="fu">colAnys</span>(feature_absence_presence <span class="sc">&gt;=</span> frequent_<span class="sc">$</span>over95)] <span class="ot">-&gt;</span> features_AP_filtered95</span>
<span id="cb574-16"><a href="#cb574-16" aria-hidden="true" tabindex="-1"></a>feature_absence_presence[, <span class="fu">colAnys</span>(feature_absence_presence <span class="sc">&gt;=</span> frequent_<span class="sc">$</span>over90)] <span class="ot">-&gt;</span> features_AP_filtered90</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb575"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a>viz_f90<span class="ot">&lt;-</span> features_AP_filtered90</span>
<span id="cb575-2"><a href="#cb575-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(viz_f90)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">colnames</span>(viz_f90),<span class="at">split=</span><span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb575-3"><a href="#cb575-3" aria-hidden="true" tabindex="-1"></a>viz_f90<span class="ot">&lt;-</span><span class="fu">t</span>(viz_f90) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb575-4"><a href="#cb575-4" aria-hidden="true" tabindex="-1"></a>viz_f90[ <span class="fu">do.call</span>(order, viz_f90),]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           md1D md12D md12Dp   u
g__Lautropia                  0    83    459   0
o__Pasteurellales             0   166    458   0
g__Gemella                    0   275    500   0
f__Fusobacteriaceae           0   355    496   0
g__Capnocytophaga             0   404    500   0
g__Leptotrichia               0   418    500   0
g__Granulicatella             0   434    499   0
f__Pasteurellaceae            0   451    500   0
p__candidate_division_CPR1    0   469    500   0
g__Bergeyella                 0   500    500   0
g__Aliivibrio                45   397    493  13
g__Streptococcus             48   469    500   1
g__Haemophilus              127   251    472   0
g__Porphyromonas            141   420    481   2
g__Fusobacterium            159   482    498  16
f__Bifidobacteriaceae       418   433    433 473
g__Robinsoniella            455   456    456 382
o__Bacillales               461   470    470 253
s__Collinsella_aerofaciens  461   476    477 463
f__Sphingomonadaceae        465   470    470 396
g__Bifidobacterium          468   471    471 470
g__Paucibacter              475   477    479 411
g__Sphingomonas             488   490    490 435
g__Lawsonella               490   499    499 461
f__Chitinophagaceae         498   498    498 489
f__Corynebacteriaceae       499   499    499 442
g__Xanthomonas              499   499    499 497
g__Chryseobacterium         500   500    500 499
g__Cutibacterium            500   500    500 500
g__Staphylococcus           500   500    500 500
f__Streptococcaceae         500   500    500 500
f__Neisseriaceae            500   500    500 500
g__Neisseria                500   500    500 500
g__Pseudomonas              500   500    500 500</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb577"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean IG = mean over all repeats</span></span>
<span id="cb577-2"><a href="#cb577-2" aria-hidden="true" tabindex="-1"></a><span class="co"># IG in repeat= max IG (median-discretized, zero-discretized)</span></span>
<span id="cb577-3"><a href="#cb577-3" aria-hidden="true" tabindex="-1"></a><span class="co"># partner in repeat= one with synergy</span></span>
<span id="cb577-4"><a href="#cb577-4" aria-hidden="true" tabindex="-1"></a><span class="co">#       if both zero and median are synergistic - arg max (IG)</span></span>
<span id="cb577-5"><a href="#cb577-5" aria-hidden="true" tabindex="-1"></a><span class="co">#overall partner - most frequent</span></span>
<span id="cb577-6"><a href="#cb577-6" aria-hidden="true" tabindex="-1"></a><span class="co">#only partners - overall partners but not in 1D or 2D relevant set 90% of times.</span></span>
<span id="cb577-7"><a href="#cb577-7" aria-hidden="true" tabindex="-1"></a>plausible<span class="ot">&lt;-</span> <span class="fu">colnames</span>(features_AP_filtered90)</span>
<span id="cb577-8"><a href="#cb577-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-9"><a href="#cb577-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(  <span class="co">#code below works if all taxa in the set plausible taxo were present in each of the</span></span>
<span id="cb577-10"><a href="#cb577-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">#subsamples (might dissapear due to filtering out of sparse columns)</span></span>
<span id="cb577-11"><a href="#cb577-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">#this condition catches this unlikely exception</span></span>
<span id="cb577-12"><a href="#cb577-12" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(<span class="fu">sapply</span>(full_MDFSres, <span class="cf">function</span>(mdfs)</span>
<span id="cb577-13"><a href="#cb577-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sapply</span>(mdfs, <span class="cf">function</span>(x) </span>
<span id="cb577-14"><a href="#cb577-14" aria-hidden="true" tabindex="-1"></a>                  plausible <span class="sc">%in%</span> x<span class="sc">$</span>feature_names</span>
<span id="cb577-15"><a href="#cb577-15" aria-hidden="true" tabindex="-1"></a>                )     </span>
<span id="cb577-16"><a href="#cb577-16" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb577-17"><a href="#cb577-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb577-18"><a href="#cb577-18" aria-hidden="true" tabindex="-1"></a>rel_2D<span class="ot">&lt;-</span></span>
<span id="cb577-19"><a href="#cb577-19" aria-hidden="true" tabindex="-1"></a>presence_mD<span class="ot">&lt;-</span>presence_0D<span class="ot">&lt;-</span>abundance_per_repD<span class="ot">&lt;-</span></span>
<span id="cb577-20"><a href="#cb577-20" aria-hidden="true" tabindex="-1"></a>presence_mH<span class="ot">&lt;-</span>presence_0H<span class="ot">&lt;-</span>abundance_per_repH<span class="ot">&lt;-</span></span>
<span id="cb577-21"><a href="#cb577-21" aria-hidden="true" tabindex="-1"></a>presence_m<span class="ot">&lt;-</span>presence_0<span class="ot">&lt;-</span>abundance_per_rep<span class="ot">&lt;-</span></span>
<span id="cb577-22"><a href="#cb577-22" aria-hidden="true" tabindex="-1"></a>IG1D<span class="ot">&lt;-</span>IG2D<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span>n_repeats, <span class="at">ncol=</span><span class="fu">length</span>(plausible))</span>
<span id="cb577-23"><a href="#cb577-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-24"><a href="#cb577-24" aria-hidden="true" tabindex="-1"></a>partners_m0<span class="ot">&lt;-</span>partners_0<span class="ot">&lt;-</span>partners_m<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span><span class="fu">length</span>(plausible), <span class="at">ncol=</span><span class="fu">ncol</span>(tdata))</span>
<span id="cb577-25"><a href="#cb577-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-26"><a href="#cb577-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>n_repeats) ){</span>
<span id="cb577-27"><a href="#cb577-27" aria-hidden="true" tabindex="-1"></a>  mdfs_j<span class="ot">&lt;-</span> full_MDFSres[[j]]</span>
<span id="cb577-28"><a href="#cb577-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_along</span>(mdfs_j)) <span class="fu">names</span>(mdfs_j[[k]]<span class="sc">$</span>statistic)<span class="ot">&lt;-</span> mdfs_j[[k]]<span class="sc">$</span>feature_names</span>
<span id="cb577-29"><a href="#cb577-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-30"><a href="#cb577-30" aria-hidden="true" tabindex="-1"></a>  rel_2D[j,]<span class="ot">=</span> plausible <span class="sc">%in%</span> <span class="fu">union</span>(mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>rel_set,</span>
<span id="cb577-31"><a href="#cb577-31" aria-hidden="true" tabindex="-1"></a>                                   mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>rel_set</span>
<span id="cb577-32"><a href="#cb577-32" aria-hidden="true" tabindex="-1"></a>                                   )</span>
<span id="cb577-33"><a href="#cb577-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-34"><a href="#cb577-34" aria-hidden="true" tabindex="-1"></a>  plaus_IG1Dm<span class="ot">&lt;-</span> mdfs_j<span class="sc">$</span>res_1Dm<span class="sc">$</span>statistic[plausible]</span>
<span id="cb577-35"><a href="#cb577-35" aria-hidden="true" tabindex="-1"></a>  plaus_IG1D0<span class="ot">&lt;-</span> mdfs_j<span class="sc">$</span>res_1D0<span class="sc">$</span>statistic[plausible]</span>
<span id="cb577-36"><a href="#cb577-36" aria-hidden="true" tabindex="-1"></a>  plaus_IG2Dm<span class="ot">&lt;-</span> mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic[plausible]</span>
<span id="cb577-37"><a href="#cb577-37" aria-hidden="true" tabindex="-1"></a>  plaus_IG2D0<span class="ot">&lt;-</span> mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>statistic[plausible]</span>
<span id="cb577-38"><a href="#cb577-38" aria-hidden="true" tabindex="-1"></a>  IG1D[j,]<span class="ot">&lt;-</span> <span class="fu">pmax</span>(plaus_IG1Dm,plaus_IG1D0)</span>
<span id="cb577-39"><a href="#cb577-39" aria-hidden="true" tabindex="-1"></a>  mIG2D_bigger<span class="ot">&lt;-</span> plaus_IG2Dm<span class="sc">&gt;</span>plaus_IG2D0</span>
<span id="cb577-40"><a href="#cb577-40" aria-hidden="true" tabindex="-1"></a>  IG2D[j,]<span class="ot">&lt;-</span> <span class="fu">pmax</span>(plaus_IG2Dm,plaus_IG2D0)</span>
<span id="cb577-41"><a href="#cb577-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-42"><a href="#cb577-42" aria-hidden="true" tabindex="-1"></a>  full_MDFSres[[<span class="dv">1</span>]]<span class="sc">$</span>res_2D0<span class="sc">$</span>partner_df[full_MDFSres[[<span class="dv">1</span>]]<span class="sc">$</span>res_2D0<span class="sc">$</span>partner_df<span class="sc">$</span>rel_name <span class="sc">%in%</span> plausible,]</span>
<span id="cb577-43"><a href="#cb577-43" aria-hidden="true" tabindex="-1"></a>  pm0j<span class="ot">&lt;-</span>pmj<span class="ot">&lt;-</span>p0j<span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="fu">length</span>(plausible), <span class="at">ncol=</span><span class="fu">ncol</span>(tdata))</span>
<span id="cb577-44"><a href="#cb577-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_p <span class="cf">in</span> <span class="fu">seq_along</span>(plausible)){</span>
<span id="cb577-45"><a href="#cb577-45" aria-hidden="true" tabindex="-1"></a>    pmj[i_p,]<span class="ot">=</span> <span class="fu">colnames</span>(tdata) <span class="sc">%in%</span>  mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>partner_df[ mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>partner_df<span class="sc">$</span>rel_name<span class="sc">==</span> plausible[[i_p]], ]<span class="sc">$</span>partner_name</span>
<span id="cb577-46"><a href="#cb577-46" aria-hidden="true" tabindex="-1"></a>    p0j[i_p,]<span class="ot">=</span> <span class="fu">colnames</span>(tdata) <span class="sc">%in%</span>  mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>partner_df[ mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>partner_df<span class="sc">$</span>rel_name<span class="sc">==</span> plausible[[i_p]], ]<span class="sc">$</span>partner_name</span>
<span id="cb577-47"><a href="#cb577-47" aria-hidden="true" tabindex="-1"></a>    pm0j[i_p,]<span class="ot">=</span> p0j[i_p,] <span class="sc">|</span> pmj[i_p,]</span>
<span id="cb577-48"><a href="#cb577-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb577-49"><a href="#cb577-49" aria-hidden="true" tabindex="-1"></a>  partners_0<span class="ot">&lt;-</span> partners_0 <span class="sc">+</span> p0j</span>
<span id="cb577-50"><a href="#cb577-50" aria-hidden="true" tabindex="-1"></a>  partners_m<span class="ot">&lt;-</span> partners_m <span class="sc">+</span> pmj</span>
<span id="cb577-51"><a href="#cb577-51" aria-hidden="true" tabindex="-1"></a>  partners_m0<span class="ot">&lt;-</span> partners_m0 <span class="sc">+</span> pm0j</span>
<span id="cb577-52"><a href="#cb577-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-53"><a href="#cb577-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#partners_0&lt;- mdfs_j$res_2D0$partner_df</span></span>
<span id="cb577-54"><a href="#cb577-54" aria-hidden="true" tabindex="-1"></a>  <span class="co">#partners_m&lt;- mdfs_j$res_2Dm$partner_df</span></span>
<span id="cb577-55"><a href="#cb577-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">#partners_0&lt;- partners_0[partners_0$synergy,]  #only those which are truly synergistic</span></span>
<span id="cb577-56"><a href="#cb577-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#partners_m&lt;- partners_m[partners_m$synergy,]</span></span>
<span id="cb577-57"><a href="#cb577-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rownames(partners_0)&lt;-partners_0$rel_name     #to make it possible to select by rows</span></span>
<span id="cb577-58"><a href="#cb577-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rownames(partners_m)&lt;-partners_m$rel_name     # see partner_j filling</span></span>
<span id="cb577-59"><a href="#cb577-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">#has_partner&lt;- plausible %in% union(partners_0$rel_name, partners_m$rel_name)</span></span>
<span id="cb577-60"><a href="#cb577-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">#partner_j&lt;- rep(NA, length(plausible))</span></span>
<span id="cb577-61"><a href="#cb577-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">#for each of the taxa that had a partner at j-th rep, </span></span>
<span id="cb577-62"><a href="#cb577-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">#if median based IG was bigger, use partner from partners_m,otherwise from partners_0</span></span>
<span id="cb577-63"><a href="#cb577-63" aria-hidden="true" tabindex="-1"></a>  <span class="co">#partner_j[has_partner]&lt;- ifelse(mIG2D_bigger[has_partner], </span></span>
<span id="cb577-64"><a href="#cb577-64" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                partners_m[plausible[has_partner],]$partner_name,</span></span>
<span id="cb577-65"><a href="#cb577-65" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                partners_0[plausible[has_partner],]$partner_name</span></span>
<span id="cb577-66"><a href="#cb577-66" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                )</span></span>
<span id="cb577-67"><a href="#cb577-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">#partners_per_rep[j,]=partner_j</span></span>
<span id="cb577-68"><a href="#cb577-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-69"><a href="#cb577-69" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mean abundance &amp; presence</span></span>
<span id="cb577-70"><a href="#cb577-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-71"><a href="#cb577-71" aria-hidden="true" tabindex="-1"></a>  plausible_ab_at_j<span class="ot">&lt;-</span>tdata[ subsample[[j]]<span class="sc">$</span>keep, plausible ]</span>
<span id="cb577-72"><a href="#cb577-72" aria-hidden="true" tabindex="-1"></a>  presence_m_at_j<span class="ot">&lt;-</span><span class="fu">binarize_taxa</span>(<span class="fu">as.matrix</span>(plausible_ab_at_j), </span>
<span id="cb577-73"><a href="#cb577-73" aria-hidden="true" tabindex="-1"></a>                <span class="at">thresholds =</span> <span class="fu">colMedians</span>(<span class="fu">as.matrix</span>(plausible_ab_at_j)) )</span>
<span id="cb577-74"><a href="#cb577-74" aria-hidden="true" tabindex="-1"></a>  presence_0_at_j<span class="ot">&lt;-</span><span class="fu">binarize_taxa</span>(<span class="fu">as.matrix</span>(plausible_ab_at_j), </span>
<span id="cb577-75"><a href="#cb577-75" aria-hidden="true" tabindex="-1"></a>                <span class="at">thresholds =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(plausible_ab_at_j))) </span>
<span id="cb577-76"><a href="#cb577-76" aria-hidden="true" tabindex="-1"></a>  abundance_per_rep[j,]<span class="ot">=</span> <span class="fu">colMeans</span>(plausible_ab_at_j)</span>
<span id="cb577-77"><a href="#cb577-77" aria-hidden="true" tabindex="-1"></a>  presence_0[j,]<span class="ot">=</span>  <span class="fu">colMeans</span>(presence_0_at_j)</span>
<span id="cb577-78"><a href="#cb577-78" aria-hidden="true" tabindex="-1"></a>  presence_m[j,]<span class="ot">=</span>  <span class="fu">colMeans</span>(presence_m_at_j)</span>
<span id="cb577-79"><a href="#cb577-79" aria-hidden="true" tabindex="-1"></a>  abundance_per_repH[j,]<span class="ot">=</span><span class="fu">colMeans</span>(plausible_ab_at_j[y[subsample[[j]]<span class="sc">$</span>keep]<span class="sc">==</span><span class="dv">0</span>, ])</span>
<span id="cb577-80"><a href="#cb577-80" aria-hidden="true" tabindex="-1"></a>  abundance_per_repD[j,]<span class="ot">=</span><span class="fu">colMeans</span>(plausible_ab_at_j[y[subsample[[j]]<span class="sc">$</span>keep]<span class="sc">==</span><span class="dv">1</span>, ])</span>
<span id="cb577-81"><a href="#cb577-81" aria-hidden="true" tabindex="-1"></a>  presence_0H[j,]<span class="ot">=</span><span class="fu">colMeans</span>(presence_0_at_j[y[subsample[[j]]<span class="sc">$</span>keep]<span class="sc">==</span><span class="dv">0</span>, ])</span>
<span id="cb577-82"><a href="#cb577-82" aria-hidden="true" tabindex="-1"></a>  presence_0D[j,]<span class="ot">=</span><span class="fu">colMeans</span>(presence_0_at_j[y[subsample[[j]]<span class="sc">$</span>keep]<span class="sc">==</span><span class="dv">1</span>, ])</span>
<span id="cb577-83"><a href="#cb577-83" aria-hidden="true" tabindex="-1"></a>  presence_mH[j,]<span class="ot">=</span><span class="fu">colMeans</span>(presence_m_at_j[y[subsample[[j]]<span class="sc">$</span>keep]<span class="sc">==</span><span class="dv">0</span>, ])</span>
<span id="cb577-84"><a href="#cb577-84" aria-hidden="true" tabindex="-1"></a>  presence_mD[j,]<span class="ot">=</span><span class="fu">colMeans</span>(presence_m_at_j[y[subsample[[j]]<span class="sc">$</span>keep]<span class="sc">==</span><span class="dv">1</span>, ])</span>
<span id="cb577-85"><a href="#cb577-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((j<span class="dv">-1</span>) <span class="sc">%%</span><span class="dv">100</span><span class="sc">==</span><span class="dv">0</span>) <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"%d/%d"</span>,j,n_repeats))</span>
<span id="cb577-86"><a href="#cb577-86" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>1/500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>101/500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>201/500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>301/500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>401/500</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb583"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a>rel_2D_named<span class="ot">&lt;-</span> rel_2D</span>
<span id="cb583-2"><a href="#cb583-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rel_2D_named)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(plausible, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb583-3"><a href="#cb583-3" aria-hidden="true" tabindex="-1"></a>freqs_pure2D<span class="ot">&lt;-</span> <span class="fu">colSums</span>(rel_2D_named)</span>
<span id="cb583-4"><a href="#cb583-4" aria-hidden="true" tabindex="-1"></a>freqs_1or2D<span class="ot">&lt;-</span> viz_f90<span class="sc">$</span>md12D</span>
<span id="cb583-5"><a href="#cb583-5" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> partners_m0</span>
<span id="cb583-6"><a href="#cb583-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vpm0)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">colnames</span>(tdata), <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb583-7"><a href="#cb583-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(vpm0)<span class="ot">&lt;-</span><span class="fu">sapply</span>(<span class="fu">strsplit</span>(plausible, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb583-8"><a href="#cb583-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">rel2D_freq=</span>freqs_pure2D,</span>
<span id="cb583-9"><a href="#cb583-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">rel12D_freq=</span>freqs_1or2D,</span>
<span id="cb583-10"><a href="#cb583-10" aria-hidden="true" tabindex="-1"></a>      vpm0[, <span class="fu">colMaxs</span>(vpm0)<span class="sc">&gt;=</span> <span class="dv">200</span>])<span class="ot">-&gt;</span> freq_and_partners</span>
<span id="cb583-11"><a href="#cb583-11" aria-hidden="true" tabindex="-1"></a>freq_and_partners<span class="ot">&lt;-</span> freq_and_partners[ freq_and_partners[, <span class="st">"rel12D_freq"</span>] <span class="sc">&gt;</span> <span class="dv">400</span>, ]</span>
<span id="cb583-12"><a href="#cb583-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(freq_and_partners, <span class="at">file=</span> <span class="st">"agp_2D_rel_freq&amp;partnerships.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb584"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> vpm0[,<span class="fu">order</span>(<span class="fu">colSums</span>(vpm0),<span class="at">decreasing=</span><span class="cn">TRUE</span>)]</span>
<span id="cb584-2"><a href="#cb584-2" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> vpm0[<span class="fu">order</span>(<span class="fu">rowSums</span>(vpm0), <span class="at">decreasing =</span> <span class="cn">TRUE</span>),]</span>
<span id="cb584-3"><a href="#cb584-3" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> vpm0[, <span class="fu">colSums</span>(vpm0)<span class="sc">&gt;</span><span class="dv">100</span>]</span>
<span id="cb584-4"><a href="#cb584-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb584-5"><a href="#cb584-5" aria-hidden="true" tabindex="-1"></a>vpm0_flat<span class="ot">&lt;-</span><span class="fu">melt</span>(vpm0)</span>
<span id="cb584-6"><a href="#cb584-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vpm0_flat)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"rel"</span>,<span class="st">"partner"</span>,<span class="st">"freq"</span>)</span>
<span id="cb584-7"><a href="#cb584-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vpm0_flat, <span class="fu">aes</span>(<span class="at">x=</span>partner,<span class="at">y=</span>rel,<span class="at">fill=</span>freq))<span class="sc">+</span> <span class="fu">geom_tile</span>()<span class="sc">+</span></span>
<span id="cb584-8"><a href="#cb584-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/plot_partnership_freq-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb585"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb585-1"><a href="#cb585-1" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> partners_m0</span>
<span id="cb585-2"><a href="#cb585-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vpm0)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">colnames</span>(tdata), <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb585-3"><a href="#cb585-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(vpm0)<span class="ot">&lt;-</span><span class="fu">sapply</span>(<span class="fu">strsplit</span>(plausible, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb585-4"><a href="#cb585-4" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> vpm0[,<span class="fu">order</span>(<span class="fu">colSums</span>(vpm0),<span class="at">decreasing=</span><span class="cn">TRUE</span>)]</span>
<span id="cb585-5"><a href="#cb585-5" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> vpm0[<span class="fu">order</span>(<span class="fu">rowSums</span>(vpm0), <span class="at">decreasing =</span> <span class="cn">TRUE</span>),]</span>
<span id="cb585-6"><a href="#cb585-6" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> vpm0[, <span class="fu">colMaxs</span>(vpm0)<span class="sc">&gt;</span><span class="dv">300</span>]</span>
<span id="cb585-7"><a href="#cb585-7" aria-hidden="true" tabindex="-1"></a>vpm0<span class="ot">&lt;-</span> vpm0[<span class="fu">rowMaxs</span>(vpm0)<span class="sc">&gt;</span><span class="dv">200</span> , ]</span>
<span id="cb585-8"><a href="#cb585-8" aria-hidden="true" tabindex="-1"></a>vpm0_flat<span class="ot">&lt;-</span><span class="fu">melt</span>(vpm0)</span>
<span id="cb585-9"><a href="#cb585-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vpm0_flat)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"rel"</span>,<span class="st">"partner"</span>,<span class="st">"freq"</span>)</span>
<span id="cb585-10"><a href="#cb585-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vpm0_flat, <span class="fu">aes</span>(<span class="at">x=</span>partner,<span class="at">y=</span>rel,<span class="at">fill=</span>freq))<span class="sc">+</span> <span class="fu">geom_tile</span>()<span class="sc">+</span></span>
<span id="cb585-11"><a href="#cb585-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb585-12"><a href="#cb585-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> freq), <span class="at">color =</span> <span class="st">"pink"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/plot_partnership_freq2-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="jackknife-estimates-of-statistics-ig-presence-abundance" class="level6">
<h6 class="anchored" data-anchor-id="jackknife-estimates-of-statistics-ig-presence-abundance">jackknife estimates of statistics: IG, presence, abundance</h6>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb586"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a>jackknife_SE<span class="ot">&lt;-</span> <span class="cf">function</span>(replicates,N,D,<span class="at">R=</span><span class="cn">NULL</span>){</span>
<span id="cb586-2"><a href="#cb586-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(R)) R<span class="ot">=</span> N<span class="sc">/</span>D</span>
<span id="cb586-3"><a href="#cb586-3" aria-hidden="true" tabindex="-1"></a>  mean_rep<span class="ot">=</span> <span class="fu">mean</span>(replicates)</span>
<span id="cb586-4"><a href="#cb586-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>((R<span class="sc">/</span><span class="fu">length</span>(replicates))<span class="sc">*</span><span class="fu">sum</span>((replicates<span class="sc">-</span>mean_rep)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb586-5"><a href="#cb586-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb587"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> <span class="fu">names</span>(global_MDFS))</span>
<span id="cb587-2"><a href="#cb587-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(global_MDFS[[v]]<span class="sc">$</span>statistic)<span class="ot">&lt;-</span> global_MDFS[[v]]<span class="sc">$</span>feature_names</span>
<span id="cb587-3"><a href="#cb587-3" aria-hidden="true" tabindex="-1"></a>fs_df<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">taxon=</span>plausible,</span>
<span id="cb587-4"><a href="#cb587-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">IG2D=</span> <span class="fu">pmax</span>(global_MDFS<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic[ plausible  ],</span>
<span id="cb587-5"><a href="#cb587-5" aria-hidden="true" tabindex="-1"></a>                                   global_MDFS<span class="sc">$</span>res_2D0<span class="sc">$</span>statistic[ plausible  ]),</span>
<span id="cb587-6"><a href="#cb587-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">IG2D_SD=</span> <span class="fu">apply</span>(IG2D,<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final) ),</span>
<span id="cb587-7"><a href="#cb587-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">IG1D=</span> <span class="fu">pmax</span>(global_MDFS<span class="sc">$</span>res_1Dm<span class="sc">$</span>statistic[ plausible  ],</span>
<span id="cb587-8"><a href="#cb587-8" aria-hidden="true" tabindex="-1"></a>                                   global_MDFS<span class="sc">$</span>res_1D0<span class="sc">$</span>statistic[ plausible  ]),</span>
<span id="cb587-9"><a href="#cb587-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">IG1D_SD=</span><span class="fu">apply</span>(IG1D,<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final)),</span>
<span id="cb587-10"><a href="#cb587-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">rel_1D=</span> features_AP_filtered90[<span class="st">"md1D"</span>,],</span>
<span id="cb587-11"><a href="#cb587-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">rel_2D=</span> <span class="fu">colSums</span>(rel_2D),</span>
<span id="cb587-12"><a href="#cb587-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">rel_u=</span>  features_AP_filtered90[<span class="st">"u"</span>,]</span>
<span id="cb587-13"><a href="#cb587-13" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb587-14"><a href="#cb587-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-15"><a href="#cb587-15" aria-hidden="true" tabindex="-1"></a>viz_fs_df<span class="ot">&lt;-</span> fs_df</span>
<span id="cb587-16"><a href="#cb587-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(viz_fs_df)<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb587-17"><a href="#cb587-17" aria-hidden="true" tabindex="-1"></a>viz_fs_df<span class="sc">$</span>taxon<span class="ot">&lt;-</span><span class="fu">sapply</span>(<span class="fu">strsplit</span>(fs_df<span class="sc">$</span>taxon,<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb587-18"><a href="#cb587-18" aria-hidden="true" tabindex="-1"></a>viz_fs_df[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]<span class="ot">&lt;-</span> <span class="fu">round</span>(viz_fs_df[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],<span class="dv">2</span>)</span>
<span id="cb587-19"><a href="#cb587-19" aria-hidden="true" tabindex="-1"></a>viz_fs_df[<span class="fu">order</span>(<span class="sc">-</span>viz_fs_df<span class="sc">$</span>IG2D) , ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        taxon   IG2D IG2D_SD   IG1D IG1D_SD rel_1D rel_2D rel_u
27               g__Neisseria 171.70   17.08 132.90   15.45    500    500   500
31             g__Pseudomonas 119.23   14.45 106.56   13.84    500    500   500
26           f__Neisseriaceae 104.29   13.61  64.60   11.00    500    500   500
14          g__Staphylococcus  72.39   11.35  64.77   11.03    500    500   500
16        f__Streptococcaceae  71.72   11.93  48.74    9.90    500    500   500
5            g__Cutibacterium  69.13   10.55  57.77   10.11    500    500   500
11        g__Chryseobacterium  55.22   10.04  47.41    9.83    500    499   499
3               g__Lawsonella  50.63    8.17  31.28    7.77    490    499   461
4       f__Corynebacteriaceae  49.28    9.13  38.27    8.71    499    498   442
8         f__Chitinophagaceae  46.21    8.64  37.69    8.16    498    487   489
33             g__Xanthomonas  43.52    7.84  36.79    7.39    499    495   497
20           g__Fusobacterium  43.27    8.26  15.84    5.48    159    482    16
17           g__Streptococcus  43.23    8.54   9.92    3.91     48    469     1
9               g__Bergeyella  41.50    7.23   0.99    1.58      0    500     0
15          g__Granulicatella  40.69    8.74   0.19    0.77      0    434     0
34 p__candidate_division_CPR1  40.64    8.30   4.62    2.87      0    469     0
24             g__Paucibacter  39.85    7.64  27.81    6.88    475    454   411
23            g__Sphingomonas  39.75    7.19  28.72    6.85    488    474   435
6  s__Collinsella_aerofaciens  39.16    7.86  25.64    6.66    461    459   463
32              g__Aliivibrio  39.08    8.21  11.49    4.39     45    397    13
29         f__Pasteurellaceae  39.01    7.92   1.99    1.71      0    451     0
19        f__Fusobacteriaceae  37.55    8.36   5.40    3.04      0    355     0
7            g__Porphyromonas  37.28    7.45  14.52    5.32    141    420     2
12              o__Bacillales  37.02    7.55  26.21    6.72    461    431   253
2          g__Bifidobacterium  36.67    8.09  26.79    7.51    468    420   470
10          g__Capnocytophaga  36.33    7.54   2.70    2.32      0    404     0
21            g__Leptotrichia  35.48    7.52   1.12    1.63      0    418     0
22       f__Sphingomonadaceae  35.06    7.36  26.53    6.89    465    427   396
13                 g__Gemella  33.94    6.88   0.07    0.63      0    275     0
18           g__Robinsoniella  32.38    8.30  25.02    7.93    455    402   382
1       f__Bifidobacteriaceae  29.79    6.94  22.64    6.40    418    396   473
28          o__Pasteurellales  29.21    6.91   3.56    2.39      0    166     0
30             g__Haemophilus  27.15    6.59  14.59    4.94    127    237     0
25               g__Lautropia  20.81    5.51   0.63    1.48      0     83     0</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb589"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(viz_fs_df<span class="sc">$</span>IG2D,<span class="fu">colMeans</span>(IG2D), </span>
<span id="cb589-2"><a href="#cb589-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">sprintf</span>(<span class="st">"IG2D- jackknife mean vs full data point estimate, </span><span class="sc">\n</span><span class="st"> cor= %.4f"</span>,</span>
<span id="cb589-3"><a href="#cb589-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cor</span>(viz_fs_df<span class="sc">$</span>IG2D,<span class="fu">colMeans</span>(IG2D))</span>
<span id="cb589-4"><a href="#cb589-4" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb589-5"><a href="#cb589-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb589-6"><a href="#cb589-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="fu">colMeans</span>(IG2D)<span class="sc">~</span>viz_fs_df<span class="sc">$</span>IG2D), <span class="at">col=</span><span class="st">"red"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb590"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb590-1"><a href="#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(viz_fs_df<span class="sc">$</span>IG1D,<span class="fu">colMeans</span>(IG1D), <span class="at">main=</span><span class="fu">sprintf</span>(<span class="st">"IG2D- jackknife mean vs full data point estimate, </span><span class="sc">\n</span><span class="st"> cor= %.4f"</span>,</span>
<span id="cb590-2"><a href="#cb590-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cor</span>(viz_fs_df<span class="sc">$</span>IG1D,<span class="fu">colMeans</span>(IG1D)) ))</span>
<span id="cb590-3"><a href="#cb590-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="fu">colMeans</span>(IG1D)<span class="sc">~</span>viz_fs_df<span class="sc">$</span>IG1D), <span class="at">col=</span><span class="st">"red"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb591"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb591-1"><a href="#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(IG2D[,<span class="dv">27</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb592"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb592-1"><a href="#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(IG1D[,<span class="dv">27</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check1-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb593"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb593-1"><a href="#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(IG2D[,<span class="dv">10</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check1-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb594"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb594-1"><a href="#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(IG1D[,<span class="dv">10</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check1-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb595"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb595-1"><a href="#cb595-1" aria-hidden="true" tabindex="-1"></a>ses<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb595-2"><a href="#cb595-2" aria-hidden="true" tabindex="-1"></a><span class="at">se100=</span><span class="fu">apply</span>(IG2D[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>,],<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final) ),</span>
<span id="cb595-3"><a href="#cb595-3" aria-hidden="true" tabindex="-1"></a><span class="at">se200=</span><span class="fu">apply</span>(IG2D[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>,],<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final) ),</span>
<span id="cb595-4"><a href="#cb595-4" aria-hidden="true" tabindex="-1"></a><span class="at">se300=</span><span class="fu">apply</span>(IG2D[<span class="dv">1</span><span class="sc">:</span><span class="dv">300</span>,],<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final) ),</span>
<span id="cb595-5"><a href="#cb595-5" aria-hidden="true" tabindex="-1"></a><span class="at">se400=</span><span class="fu">apply</span>(IG2D[<span class="dv">1</span><span class="sc">:</span><span class="dv">400</span>,],<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final) ),</span>
<span id="cb595-6"><a href="#cb595-6" aria-hidden="true" tabindex="-1"></a><span class="at">se500=</span><span class="fu">apply</span>(IG2D[<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,],<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final) )</span>
<span id="cb595-7"><a href="#cb595-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb596"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb596-1"><a href="#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(ses))</span>
<span id="cb596-2"><a href="#cb596-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(ses))</span>
<span id="cb596-3"><a href="#cb596-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i<span class="sc">&lt;</span>j)</span>
<span id="cb596-4"><a href="#cb596-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(ses[[i]],ses[[j]], <span class="at">main=</span><span class="fu">sprintf</span>(<span class="st">"%s vs %s"</span>, <span class="fu">names</span>(ses)[[i]], <span class="fu">names</span>(ses)[[j]] ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="agp_analysis_public_files/figure-html/jack_check3-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb597"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a>taxonomy.mean.final<span class="ot">&lt;-</span> taxonomy.mean.final<span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb597-2"><a href="#cb597-2" aria-hidden="true" tabindex="-1"></a>pab_df<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">taxon=</span>plausible,</span>
<span id="cb597-3"><a href="#cb597-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ab=</span> <span class="fu">colMeans</span>(taxonomy.mean.final[,plausible]),</span>
<span id="cb597-4"><a href="#cb597-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ab_SD=</span> <span class="fu">apply</span>(abundance_per_rep,<span class="dv">2</span>,jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final), <span class="fl">0.37</span><span class="sc">*</span> <span class="fu">nrow</span>(taxonomy.mean.final) ),</span>
<span id="cb597-5"><a href="#cb597-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">abH=</span> <span class="fu">colMeans</span>(taxonomy.mean.final[ decision.mean.final<span class="sc">==</span><span class="dv">0</span> ,plausible]),</span>
<span id="cb597-6"><a href="#cb597-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">abH_SD=</span> <span class="fu">apply</span>(abundance_per_repH,<span class="dv">2</span>,jackknife_SE, <span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb597-7"><a href="#cb597-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="fl">0.37</span><span class="sc">*</span><span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">0</span>)),</span>
<span id="cb597-8"><a href="#cb597-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">abD=</span> <span class="fu">colMeans</span>(taxonomy.mean.final[ decision.mean.final<span class="sc">==</span><span class="dv">1</span> ,plausible]),</span>
<span id="cb597-9"><a href="#cb597-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">abD_SD=</span> <span class="fu">apply</span>(abundance_per_repH,<span class="dv">2</span>,jackknife_SE, <span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb597-10"><a href="#cb597-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="fl">0.37</span><span class="sc">*</span><span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">1</span>)),</span>
<span id="cb597-11"><a href="#cb597-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">pr=</span><span class="fu">colMeans</span>(presence_0),</span>
<span id="cb597-12"><a href="#cb597-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">pr_SD=</span><span class="fu">apply</span>(presence_0,<span class="dv">2</span>, jackknife_SE, <span class="fu">nrow</span>(taxonomy.mean.final),</span>
<span id="cb597-13"><a href="#cb597-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="fl">0.37</span><span class="sc">*</span><span class="fu">nrow</span>(taxonomy.mean.final)),</span>
<span id="cb597-14"><a href="#cb597-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prH=</span><span class="fu">colMeans</span>(presence_0H),</span>
<span id="cb597-15"><a href="#cb597-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prH_SD=</span><span class="fu">apply</span>(presence_0H,<span class="dv">2</span>,jackknife_SE, <span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">0</span>), </span>
<span id="cb597-16"><a href="#cb597-16" aria-hidden="true" tabindex="-1"></a>                                      <span class="fl">0.37</span><span class="sc">*</span><span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">0</span>)),</span>
<span id="cb597-17"><a href="#cb597-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prD=</span><span class="fu">colMeans</span>(presence_0D),</span>
<span id="cb597-18"><a href="#cb597-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prD_SD=</span><span class="fu">apply</span>(presence_0D,<span class="dv">2</span>,jackknife_SE, <span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb597-19"><a href="#cb597-19" aria-hidden="true" tabindex="-1"></a>                                      <span class="fl">0.37</span><span class="sc">*</span><span class="fu">sum</span>(decision.mean.final<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb597-20"><a href="#cb597-20" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb597-21"><a href="#cb597-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-22"><a href="#cb597-22" aria-hidden="true" tabindex="-1"></a>viz_pab_df<span class="ot">&lt;-</span> pab_df</span>
<span id="cb597-23"><a href="#cb597-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(viz_pab_df)<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb597-24"><a href="#cb597-24" aria-hidden="true" tabindex="-1"></a>viz_pab_df<span class="sc">$</span>taxon<span class="ot">&lt;-</span><span class="fu">sapply</span>(<span class="fu">strsplit</span>(pab_df<span class="sc">$</span>taxon,<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb597-25"><a href="#cb597-25" aria-hidden="true" tabindex="-1"></a>viz_pab_df[, <span class="fu">grep</span>(<span class="st">"ab"</span>,<span class="fu">colnames</span>(viz_pab_df))]<span class="ot">&lt;-</span><span class="dv">10000</span><span class="sc">*</span>viz_pab_df[, <span class="fu">grep</span>(<span class="st">"ab"</span>,<span class="fu">colnames</span>(viz_pab_df))]</span>
<span id="cb597-26"><a href="#cb597-26" aria-hidden="true" tabindex="-1"></a>viz_pab_df[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(viz_pab_df)]<span class="ot">&lt;-</span> <span class="fu">round</span>(viz_pab_df[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(viz_pab_df)],<span class="dv">2</span>)</span>
<span id="cb597-27"><a href="#cb597-27" aria-hidden="true" tabindex="-1"></a>viz_pab_df[<span class="fu">order</span>(<span class="sc">-</span>viz_fs_df<span class="sc">$</span>IG2D) , ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        taxon    ab ab_SD    abH abH_SD   abD abD_SD   pr pr_SD
27               g__Neisseria  3.54  1.33   4.79   2.32  2.46   2.32 0.38  0.01
31             g__Pseudomonas 65.46  6.78  59.01  10.45 71.05  10.45 0.64  0.01
26           f__Neisseriaceae  0.37  0.08   0.30   0.08  0.44   0.08 0.22  0.01
14          g__Staphylococcus  2.65  1.13   2.03   0.52  3.18   0.52 0.33  0.01
16        f__Streptococcaceae  9.52  0.96   8.24   1.37 10.64   1.37 0.77  0.01
5            g__Cutibacterium  0.19  0.13   0.07   0.03  0.29   0.03 0.08  0.01
11        g__Chryseobacterium  1.64  0.64   1.36   0.71  1.88   0.71 0.09  0.01
3               g__Lawsonella  0.59  0.07   0.49   0.10  0.67   0.10 0.19  0.01
4       f__Corynebacteriaceae 10.88  3.30  10.93   6.51 10.83   6.51 0.51  0.01
8         f__Chitinophagaceae  0.09  0.04   0.06   0.06  0.11   0.06 0.05  0.00
33             g__Xanthomonas  0.25  0.08   0.02   0.01  0.44   0.01 0.03  0.00
20           g__Fusobacterium  6.80  1.70   6.62   2.06  6.96   2.06 0.35  0.01
17           g__Streptococcus 32.06  5.02  42.93   8.92 22.64   8.92 0.92  0.01
9               g__Bergeyella  0.21  0.05   0.30   0.09  0.14   0.09 0.10  0.01
15          g__Granulicatella  0.25  0.07   0.24   0.08  0.25   0.08 0.10  0.01
34 p__candidate_division_CPR1  0.06  0.03   0.10   0.07  0.03   0.07 0.04  0.00
24             g__Paucibacter  0.22  0.06   0.09   0.02  0.33   0.02 0.10  0.01
23            g__Sphingomonas  0.16  0.06   0.09   0.03  0.21   0.03 0.07  0.01
6  s__Collinsella_aerofaciens  5.43  0.42   6.49   0.56  4.50   0.56 0.61  0.01
32              g__Aliivibrio  0.01  0.00   0.01   0.00  0.00   0.00 0.02  0.00
29         f__Pasteurellaceae  2.06  0.40   2.54   0.76  1.64   0.76 0.43  0.01
19        f__Fusobacteriaceae  0.13  0.03   0.11   0.03  0.14   0.03 0.08  0.01
7            g__Porphyromonas 10.88  1.34  10.10   1.63 11.55   1.63 0.58  0.01
12              o__Bacillales 22.36  2.13  20.55   2.89 23.92   2.89 0.78  0.01
2          g__Bifidobacterium 93.97  6.26 105.40   8.99 84.05   8.99 0.87  0.01
10          g__Capnocytophaga  0.13  0.08   0.22   0.16  0.04   0.16 0.06  0.01
21            g__Leptotrichia  0.66  0.25   1.03   0.49  0.33   0.49 0.13  0.01
22       f__Sphingomonadaceae  0.36  0.12   0.28   0.14  0.43   0.14 0.07  0.01
13                 g__Gemella  1.27  0.36   1.17   0.32  1.36   0.32 0.25  0.01
18           g__Robinsoniella  0.09  0.01   0.06   0.01  0.11   0.01 0.09  0.01
1       f__Bifidobacteriaceae  1.20  0.09   1.40   0.14  1.03   0.14 0.48  0.01
28          o__Pasteurellales  0.10  0.01   0.12   0.02  0.08   0.02 0.12  0.01
30             g__Haemophilus 14.90  2.35  18.16   3.34 12.07   3.34 0.66  0.01
25               g__Lautropia  0.07  0.02   0.08   0.05  0.06   0.05 0.07  0.01
    prH prH_SD  prD prD_SD
27 0.26   0.01 0.48   0.02
31 0.55   0.01 0.72   0.01
26 0.15   0.01 0.28   0.01
14 0.25   0.01 0.39   0.01
16 0.73   0.01 0.80   0.01
5  0.04   0.01 0.12   0.01
11 0.05   0.01 0.13   0.01
3  0.14   0.01 0.23   0.01
4  0.44   0.02 0.56   0.01
8  0.02   0.00 0.07   0.01
33 0.01   0.00 0.05   0.01
20 0.31   0.01 0.38   0.01
17 0.90   0.01 0.93   0.01
9  0.11   0.01 0.09   0.01
15 0.10   0.01 0.10   0.01
34 0.05   0.01 0.04   0.01
24 0.07   0.01 0.13   0.01
23 0.04   0.01 0.09   0.01
6  0.64   0.01 0.59   0.01
32 0.03   0.01 0.01   0.00
29 0.42   0.02 0.44   0.01
19 0.09   0.01 0.07   0.01
7  0.54   0.02 0.61   0.01
12 0.74   0.01 0.81   0.01
2  0.90   0.01 0.85   0.01
10 0.07   0.01 0.05   0.01
21 0.12   0.01 0.14   0.01
22 0.04   0.01 0.09   0.01
13 0.25   0.01 0.25   0.01
18 0.06   0.01 0.12   0.01
1  0.53   0.01 0.44   0.01
28 0.13   0.01 0.11   0.01
30 0.62   0.02 0.69   0.01
25 0.07   0.01 0.08   0.01</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb599"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>( viz_fs_df[<span class="fu">order</span>(<span class="sc">-</span>viz_fs_df<span class="sc">$</span>IG2D),],</span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>       viz_pab_df[<span class="fu">order</span>(<span class="sc">-</span>viz_fs_df<span class="sc">$</span>IG2D) , <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(viz_pab_df) ]),</span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a><span class="at">file=</span><span class="st">"agp_data_per_taxa.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="mdfs-3d-test" class="level5">
<h5 class="anchored" data-anchor-id="mdfs-3d-test">MDFS 3D test</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb600"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb600-1"><a href="#cb600-1" aria-hidden="true" tabindex="-1"></a>MDFS3D<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"agp_result_3D.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>All confirmed taxa in 2D appear in 3D:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb601"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a>i<span class="ot">=</span><span class="dv">1</span>;j<span class="ot">=</span><span class="dv">1</span>;</span>
<span id="cb601-2"><a href="#cb601-2" aria-hidden="true" tabindex="-1"></a>setSim<span class="ot">=</span><span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb601-3"><a href="#cb601-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (set1 <span class="cf">in</span> <span class="fu">list</span>( </span>
<span id="cb601-4"><a href="#cb601-4" aria-hidden="true" tabindex="-1"></a><span class="fu">union</span>(MDFS3D<span class="sc">$</span>median<span class="sc">$</span>rel_set, MDFS3D<span class="sc">$</span>zero<span class="sc">$</span>rel_set),</span>
<span id="cb601-5"><a href="#cb601-5" aria-hidden="true" tabindex="-1"></a>fs_df<span class="sc">$</span>taxon) ){<span class="cf">for</span> (set2 <span class="cf">in</span> <span class="fu">list</span>(</span>
<span id="cb601-6"><a href="#cb601-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">union</span>(MDFS3D<span class="sc">$</span>median<span class="sc">$</span>rel_set, MDFS3D<span class="sc">$</span>zero<span class="sc">$</span>rel_set),</span>
<span id="cb601-7"><a href="#cb601-7" aria-hidden="true" tabindex="-1"></a>fs_df<span class="sc">$</span>taxon</span>
<span id="cb601-8"><a href="#cb601-8" aria-hidden="true" tabindex="-1"></a>)){</span>
<span id="cb601-9"><a href="#cb601-9" aria-hidden="true" tabindex="-1"></a>      setSim[i,j]<span class="ot">=</span> <span class="fu">length</span>(<span class="fu">intersect</span>(set1,set2))</span>
<span id="cb601-10"><a href="#cb601-10" aria-hidden="true" tabindex="-1"></a>      j<span class="ot">=</span>j<span class="sc">+</span><span class="dv">1</span>;</span>
<span id="cb601-11"><a href="#cb601-11" aria-hidden="true" tabindex="-1"></a>};i<span class="ot">=</span>i<span class="sc">+</span><span class="dv">1</span>; j<span class="ot">=</span><span class="dv">1</span>}</span>
<span id="cb601-12"><a href="#cb601-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-13"><a href="#cb601-13" aria-hidden="true" tabindex="-1"></a>setSim</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]   70   34
[2,]   34   34</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb603"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb603-1"><a href="#cb603-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Maximum IG of 3D vars NOT in set of taxa selected at least 90% of times:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Maximum IG of 3D vars NOT in set of taxa selected at least 90% of times:"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb605"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">setdiff</span>( <span class="fu">union</span>(MDFS3D<span class="sc">$</span>median<span class="sc">$</span>rel_set, MDFS3D<span class="sc">$</span>zero<span class="sc">$</span>rel_set), fs_df<span class="sc">$</span>taxon)<span class="ot">-&gt;</span> only3D</span>
<span id="cb605-2"><a href="#cb605-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(</span>
<span id="cb605-3"><a href="#cb605-3" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(</span>
<span id="cb605-4"><a href="#cb605-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">mapply</span>(<span class="cf">function</span>(mdfs, restriction){</span>
<span id="cb605-5"><a href="#cb605-5" aria-hidden="true" tabindex="-1"></a>    mdfs<span class="sc">$</span>statistic[ mdfs<span class="sc">$</span>feature_names <span class="sc">%in%</span> restriction ]</span>
<span id="cb605-6"><a href="#cb605-6" aria-hidden="true" tabindex="-1"></a> }, MDFS3D, <span class="fu">list</span>(only3D, only3D))</span>
<span id="cb605-7"><a href="#cb605-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb605-8"><a href="#cb605-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47.6062</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb607"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a>IG3D_med<span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">taxon=</span> MDFS3D<span class="sc">$</span>median<span class="sc">$</span>feature_names,</span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">statisitc=</span>MDFS3D<span class="sc">$</span>median<span class="sc">$</span>statistic)</span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a>IG3D_zero<span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">taxon=</span> MDFS3D<span class="sc">$</span>zero<span class="sc">$</span>feature_names,</span>
<span id="cb607-4"><a href="#cb607-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">statisitc=</span>MDFS3D<span class="sc">$</span>zero<span class="sc">$</span>statistic)</span>
<span id="cb607-5"><a href="#cb607-5" aria-hidden="true" tabindex="-1"></a>IG3D_med<span class="ot">&lt;-</span> IG3D_med[ IG3D_med<span class="sc">$</span>taxon <span class="sc">%in%</span> fs_df<span class="sc">$</span>taxon,  ]</span>
<span id="cb607-6"><a href="#cb607-6" aria-hidden="true" tabindex="-1"></a>IG3D_zero<span class="ot">&lt;-</span> IG3D_zero[ IG3D_zero<span class="sc">$</span>taxon <span class="sc">%in%</span> fs_df<span class="sc">$</span>taxon,  ]</span>
<span id="cb607-7"><a href="#cb607-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-8"><a href="#cb607-8" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">all</span>(IG3D_med<span class="sc">$</span>taxon <span class="sc">==</span> IG3D_zero<span class="sc">$</span>taxon))</span>
<span id="cb607-9"><a href="#cb607-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-10"><a href="#cb607-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">taxon=</span>viz_fs_df<span class="sc">$</span>taxon,</span>
<span id="cb607-11"><a href="#cb607-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">IG3D=</span> <span class="fu">pmax</span>(IG3D_med<span class="sc">$</span>statisitc, IG3D_zero<span class="sc">$</span>statisitc),</span>
<span id="cb607-12"><a href="#cb607-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">IG2D=</span> viz_fs_df<span class="sc">$</span>IG2D</span>
<span id="cb607-13"><a href="#cb607-13" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb607-14"><a href="#cb607-14" aria-hidden="true" tabindex="-1"></a>           )<span class="ot">-&gt;</span> IG2Dv3D</span>
<span id="cb607-15"><a href="#cb607-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-16"><a href="#cb607-16" aria-hidden="true" tabindex="-1"></a>IG2Dv3D<span class="sc">$</span>IG_increase<span class="ot">=</span> IG2Dv3D<span class="sc">$</span>IG3D <span class="sc">-</span> IG2Dv3D<span class="sc">$</span>IG2D</span>
<span id="cb607-17"><a href="#cb607-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-18"><a href="#cb607-18" aria-hidden="true" tabindex="-1"></a>IG2Dv3D[<span class="fu">order</span>(<span class="sc">-</span>IG2Dv3D<span class="sc">$</span>IG_increase),]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        taxon      IG3D   IG2D IG_increase
17           g__Streptococcus  72.11890  43.23   28.888896
9               g__Bergeyella  70.27905  41.50   28.779053
29         f__Pasteurellaceae  59.40601  39.01   20.396006
1       f__Bifidobacteriaceae  49.86133  29.79   20.071328
10          g__Capnocytophaga  54.98315  36.33   18.653154
31             g__Pseudomonas 137.75024 119.23   18.520244
26           f__Neisseriaceae 118.96924 104.29   14.679238
21            g__Leptotrichia  49.88623  35.48   14.406230
16        f__Streptococcaceae  84.92529  71.72   13.205293
22       f__Sphingomonadaceae  48.11011  35.06   13.050107
6  s__Collinsella_aerofaciens  51.90234  39.16   12.742344
5            g__Cutibacterium  81.68433  69.13   12.554326
34 p__candidate_division_CPR1  53.05371  40.64   12.413711
15          g__Granulicatella  52.36011  40.69   11.670107
2          g__Bifidobacterium  47.74854  36.67   11.078535
19        f__Fusobacteriaceae  48.23682  37.55   10.686816
25               g__Lautropia  31.35986  20.81   10.549863
7            g__Porphyromonas  47.51709  37.28   10.237090
30             g__Haemophilus  37.30103  27.15   10.151025
13                 g__Gemella  43.99048  33.94   10.050479
4       f__Corynebacteriaceae  59.05029  49.28    9.770293
18           g__Robinsoniella  41.92163  32.38    9.541631
12              o__Bacillales  46.44312  37.02    9.423115
28          o__Pasteurellales  38.20605  29.21    8.996055
32              g__Aliivibrio  47.99561  39.08    8.915605
27               g__Neisseria 180.21704 171.70    8.517041
14          g__Staphylococcus  80.83813  72.39    8.448135
11        g__Chryseobacterium  63.23389  55.22    8.013887
20           g__Fusobacterium  51.19116  43.27    7.921162
3               g__Lawsonella  57.74756  50.63    7.117559
8         f__Chitinophagaceae  51.91992  46.21    5.709922
23            g__Sphingomonas  45.21387  39.75    5.463867
33             g__Xanthomonas  48.82593  43.52    5.305928
24             g__Paucibacter  44.05225  39.85    4.202246</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb609"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb609-1"><a href="#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.matrix</span>(IG2Dv3D[<span class="fu">order</span>(<span class="sc">-</span>IG2Dv3D<span class="sc">$</span>IG_increase),]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   taxon                        IG3D        IG2D     IG_increase
17 "g__Streptococcus"           " 72.11890" " 43.23" "28.888896"
9  "g__Bergeyella"              " 70.27905" " 41.50" "28.779053"
29 "f__Pasteurellaceae"         " 59.40601" " 39.01" "20.396006"
1  "f__Bifidobacteriaceae"      " 49.86133" " 29.79" "20.071328"
10 "g__Capnocytophaga"          " 54.98315" " 36.33" "18.653154"
31 "g__Pseudomonas"             "137.75024" "119.23" "18.520244"
26 "f__Neisseriaceae"           "118.96924" "104.29" "14.679238"
21 "g__Leptotrichia"            " 49.88623" " 35.48" "14.406230"
16 "f__Streptococcaceae"        " 84.92529" " 71.72" "13.205293"
22 "f__Sphingomonadaceae"       " 48.11011" " 35.06" "13.050107"
6  "s__Collinsella_aerofaciens" " 51.90234" " 39.16" "12.742344"
5  "g__Cutibacterium"           " 81.68433" " 69.13" "12.554326"
34 "p__candidate_division_CPR1" " 53.05371" " 40.64" "12.413711"
15 "g__Granulicatella"          " 52.36011" " 40.69" "11.670107"
2  "g__Bifidobacterium"         " 47.74854" " 36.67" "11.078535"
19 "f__Fusobacteriaceae"        " 48.23682" " 37.55" "10.686816"
25 "g__Lautropia"               " 31.35986" " 20.81" "10.549863"
7  "g__Porphyromonas"           " 47.51709" " 37.28" "10.237090"
30 "g__Haemophilus"             " 37.30103" " 27.15" "10.151025"
13 "g__Gemella"                 " 43.99048" " 33.94" "10.050479"
4  "f__Corynebacteriaceae"      " 59.05029" " 49.28" " 9.770293"
18 "g__Robinsoniella"           " 41.92163" " 32.38" " 9.541631"
12 "o__Bacillales"              " 46.44312" " 37.02" " 9.423115"
28 "o__Pasteurellales"          " 38.20605" " 29.21" " 8.996055"
32 "g__Aliivibrio"              " 47.99561" " 39.08" " 8.915605"
27 "g__Neisseria"               "180.21704" "171.70" " 8.517041"
14 "g__Staphylococcus"          " 80.83813" " 72.39" " 8.448135"
11 "g__Chryseobacterium"        " 63.23389" " 55.22" " 8.013887"
20 "g__Fusobacterium"           " 51.19116" " 43.27" " 7.921162"
3  "g__Lawsonella"              " 57.74756" " 50.63" " 7.117559"
8  "f__Chitinophagaceae"        " 51.91992" " 46.21" " 5.709922"
23 "g__Sphingomonas"            " 45.21387" " 39.75" " 5.463867"
33 "g__Xanthomonas"             " 48.82593" " 43.52" " 5.305928"
24 "g__Paucibacter"             " 44.05225" " 39.85" " 4.202246"</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb611"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb611-1"><a href="#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(MDFS3D<span class="sc">$</span>median<span class="sc">$</span>statistic[MDFS3D<span class="sc">$</span>median<span class="sc">$</span>relevant.variables])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.69531</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb613"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb613-1"><a href="#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(MDFS3D<span class="sc">$</span>zero<span class="sc">$</span>statistic[MDFS3D<span class="sc">$</span>zero<span class="sc">$</span>relevant.variables])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.35986</code></pre>
</div>
</div>
</section>
<section id="permutation-test" class="level5">
<h5 class="anchored" data-anchor-id="permutation-test">Permutation test</h5>
<p>Performed by <code>permutation_test.R</code> script - same basic steps of repeated subsampling 500 times and feature selection, but with decision labels permuted each time before sampling happens. This allows us to assess, independently of our testing method, the false positive rate of feature selection for all of the tested methods.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb615"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb615-1"><a href="#cb615-1" aria-hidden="true" tabindex="-1"></a>n_perm<span class="ot">&lt;-</span><span class="dv">500</span></span>
<span id="cb615-2"><a href="#cb615-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-3"><a href="#cb615-3" aria-hidden="true" tabindex="-1"></a>perm_subsample<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">'agp_subsamples63_perm.rds'</span>)</span>
<span id="cb615-4"><a href="#cb615-4" aria-hidden="true" tabindex="-1"></a>lop<span class="ot">=</span> <span class="fl">0.37</span> <span class="co">#leave out percentage</span></span>
<span id="cb615-5"><a href="#cb615-5" aria-hidden="true" tabindex="-1"></a>perm_features<span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">md1D=</span><span class="fu">list</span>(),</span>
<span id="cb615-6"><a href="#cb615-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">md12D=</span><span class="fu">list</span>(),</span>
<span id="cb615-7"><a href="#cb615-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">md12Dp=</span><span class="fu">list</span>(),</span>
<span id="cb615-8"><a href="#cb615-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">u=</span><span class="fu">list</span>()</span>
<span id="cb615-9"><a href="#cb615-9" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb615-10"><a href="#cb615-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb615-11"><a href="#cb615-11" aria-hidden="true" tabindex="-1"></a>perm_fs_j_pattern<span class="ot">=</span><span class="st">"features/perm_agp_fs_set_j=%d_lop=%.2f.rds"</span></span>
<span id="cb615-12"><a href="#cb615-12" aria-hidden="true" tabindex="-1"></a> perm_full_MDFSres<span class="ot">&lt;-</span> perm_full_Ures<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb615-13"><a href="#cb615-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_perm){</span>
<span id="cb615-14"><a href="#cb615-14" aria-hidden="true" tabindex="-1"></a>  fs_j_fname<span class="ot">=</span> <span class="fu">sprintf</span>(perm_fs_j_pattern,j,lop)</span>
<span id="cb615-15"><a href="#cb615-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(fs_j_fname))</span>
<span id="cb615-16"><a href="#cb615-16" aria-hidden="true" tabindex="-1"></a>        fs_j<span class="ot">=</span><span class="fu">readRDS</span>(fs_j_fname)</span>
<span id="cb615-17"><a href="#cb615-17" aria-hidden="true" tabindex="-1"></a>        all_mdfs_j<span class="ot">=</span>fs_j<span class="sc">$</span>mdfs</span>
<span id="cb615-18"><a href="#cb615-18" aria-hidden="true" tabindex="-1"></a>        u_j<span class="ot">=</span>fs_j<span class="sc">$</span>u</span>
<span id="cb615-19"><a href="#cb615-19" aria-hidden="true" tabindex="-1"></a>  perm_full_MDFSres[[j]]<span class="ot">=</span>all_mdfs_j</span>
<span id="cb615-20"><a href="#cb615-20" aria-hidden="true" tabindex="-1"></a>  perm_full_Ures[[j]]<span class="ot">=</span>u_j</span>
<span id="cb615-21"><a href="#cb615-21" aria-hidden="true" tabindex="-1"></a>  perm_features<span class="sc">$</span>u[[j]]<span class="ot">=</span>u_j<span class="sc">$</span>rel_set</span>
<span id="cb615-22"><a href="#cb615-22" aria-hidden="true" tabindex="-1"></a>  perm_features<span class="sc">$</span>md1D[[j]]<span class="ot">=</span><span class="fu">union</span>(all_mdfs_j<span class="sc">$</span>res_1Dm<span class="sc">$</span>rel_set, all_mdfs_j<span class="sc">$</span>res_1D0<span class="sc">$</span>rel_set)</span>
<span id="cb615-23"><a href="#cb615-23" aria-hidden="true" tabindex="-1"></a>  perm_features<span class="sc">$</span>md12D[[j]]<span class="ot">=</span><span class="fu">Reduce</span>(union, <span class="fu">list</span>(all_mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>rel_set, </span>
<span id="cb615-24"><a href="#cb615-24" aria-hidden="true" tabindex="-1"></a>                    all_mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>rel_set,</span>
<span id="cb615-25"><a href="#cb615-25" aria-hidden="true" tabindex="-1"></a>                    perm_features<span class="sc">$</span>md1D[[j]]))</span>
<span id="cb615-26"><a href="#cb615-26" aria-hidden="true" tabindex="-1"></a>  perm_features<span class="sc">$</span>md12Dp[[j]]<span class="ot">=</span><span class="fu">Reduce</span>(union, <span class="fu">list</span>(all_mdfs_j<span class="sc">$</span>res_2Dm<span class="sc">$</span>partner_set, </span>
<span id="cb615-27"><a href="#cb615-27" aria-hidden="true" tabindex="-1"></a>                    all_mdfs_j<span class="sc">$</span>res_2D0<span class="sc">$</span>partner_set,</span>
<span id="cb615-28"><a href="#cb615-28" aria-hidden="true" tabindex="-1"></a>                    perm_features<span class="sc">$</span>md12D[[j]]))</span>
<span id="cb615-29"><a href="#cb615-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb616"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> perm_full_MDFSres)</span>
<span id="cb616-2"><a href="#cb616-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(x<span class="sc">$</span>res_1D0<span class="sc">$</span>statistic[ <span class="fu">grep</span>(<span class="st">"g__Neisseria$"</span>,x<span class="sc">$</span>res_1D0<span class="sc">$</span>feature_names) ]<span class="sc">==</span></span>
<span id="cb616-3"><a href="#cb616-3" aria-hidden="true" tabindex="-1"></a>        x<span class="sc">$</span>res_1Dm<span class="sc">$</span>statistic[ <span class="fu">grep</span>(<span class="st">"g__Neisseria$"</span>,x<span class="sc">$</span>res_1Dm<span class="sc">$</span>feature_names) ])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE
[1] TRUE</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb618"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb618-1"><a href="#cb618-1" aria-hidden="true" tabindex="-1"></a>someidx<span class="ot">&lt;-</span><span class="dv">30</span></span>
<span id="cb618-2"><a href="#cb618-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"some real example: "</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "some real example: "</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb620"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb620-1"><a href="#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">y_real=</span>y[ subsample[[someidx]]<span class="sc">$</span>keep ])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>y_real
   0    1 
1049 1263 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb622"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb622-1"><a href="#cb622-1" aria-hidden="true" tabindex="-1"></a>tmptaxa<span class="ot">&lt;-</span> tdata</span>
<span id="cb622-2"><a href="#cb622-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmptaxa)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">colnames</span>(tmptaxa),<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb622-3"><a href="#cb622-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb622-4"><a href="#cb622-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(table,<span class="fu">c</span>( </span>
<span id="cb622-5"><a href="#cb622-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">binarize_taxa</span>(tmptaxa[subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb622-6"><a href="#cb622-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">grep</span>(<span class="fu">c</span>(<span class="st">"g__Neisseria$|g__Bergeyella$"</span>), <span class="fu">colnames</span>(tmptaxa))],</span>
<span id="cb622-7"><a href="#cb622-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">thresholds=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>)) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">as.list</span>(),</span>
<span id="cb622-8"><a href="#cb622-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">list</span>( <span class="at">y_real=</span>y[ subsample[[someidx]]<span class="sc">$</span>keep ]) )</span>
<span id="cb622-9"><a href="#cb622-9" aria-hidden="true" tabindex="-1"></a>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  g__Bergeyella g__Neisseria y_real Freq
1             0            0      0  761
2             1            0      0    5
3             0            1      0  181
4             1            1      0  102
5             0            0      1  671
6             1            0      1    3
7             0            1      1  472
8             1            1      1  117</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb624"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb624-1"><a href="#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">212</span>)</span>
<span id="cb624-2"><a href="#cb624-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (someidx <span class="cf">in</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,<span class="dv">5</span>,<span class="at">replace=</span><span class="cn">FALSE</span>)){</span>
<span id="cb624-3"><a href="#cb624-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"permutation #%d :"</span>, someidx))</span>
<span id="cb624-4"><a href="#cb624-4" aria-hidden="true" tabindex="-1"></a>yp<span class="ot">&lt;-</span> y</span>
<span id="cb624-5"><a href="#cb624-5" aria-hidden="true" tabindex="-1"></a>yp[] <span class="ot">&lt;-</span> y [ perm_subsample[[someidx]]<span class="sc">$</span>p_idx ]</span>
<span id="cb624-6"><a href="#cb624-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(<span class="at">y_permuted=</span>yp[ perm_subsample[[someidx]]<span class="sc">$</span>keep ]))</span>
<span id="cb624-7"><a href="#cb624-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"y_permuted vs y:"</span>)</span>
<span id="cb624-8"><a href="#cb624-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(<span class="at">y_real=</span>y[ subsample[[someidx]]<span class="sc">$</span>keep ] , <span class="at">y_permuted=</span>yp[ perm_subsample[[someidx]]<span class="sc">$</span>keep ] ))</span>
<span id="cb624-9"><a href="#cb624-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(table,<span class="fu">c</span>( </span>
<span id="cb624-10"><a href="#cb624-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">binarize_taxa</span>(tmptaxa[perm_subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb624-11"><a href="#cb624-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">grep</span>(<span class="fu">c</span>(<span class="st">"g__Neisseria$|g__Bergeyella$"</span>), <span class="fu">colnames</span>(tmptaxa))],</span>
<span id="cb624-12"><a href="#cb624-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">thresholds=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>)) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">as.list</span>(),</span>
<span id="cb624-13"><a href="#cb624-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">list</span>( <span class="at">y_permuted=</span>yp[ perm_subsample[[someidx]]<span class="sc">$</span>keep ]) )</span>
<span id="cb624-14"><a href="#cb624-14" aria-hidden="true" tabindex="-1"></a>)))</span>
<span id="cb624-15"><a href="#cb624-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "permutation #462 :"
y_permuted
   0    1 
1011 1301 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 470 592
     1 541 709
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  630
2             1            0          0    8
3             0            1          0  289
4             1            1          0   84
5             0            0          1  777
6             1            0          1    3
7             0            1          1  391
8             1            1          1  130
[1] "permutation #72 :"
y_permuted
   0    1 
 999 1313 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 455 616
     1 544 697
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  601
2             1            0          0    2
3             0            1          0  281
4             1            1          0  115
5             0            0          1  817
6             1            0          1   11
7             0            1          1  384
8             1            1          1  101
[1] "permutation #51 :"
y_permuted
   0    1 
1003 1309 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 482 599
     1 521 710
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  634
2             1            0          0    5
3             0            1          0  287
4             1            1          0   77
5             0            0          1  805
6             1            0          1    3
7             0            1          1  365
8             1            1          1  136
[1] "permutation #336 :"
y_permuted
   0    1 
1034 1278 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 458 592
     1 576 686
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  635
2             1            0          0    7
3             0            1          0  294
4             1            1          0   98
5             0            0          1  798
6             1            0          1    4
7             0            1          1  353
8             1            1          1  123
[1] "permutation #481 :"
y_permuted
   0    1 
1020 1292 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 447 632
     1 573 660
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  632
2             1            0          0    6
3             0            1          0  277
4             1            1          0  105
5             0            0          1  782
6             1            0          1    7
7             0            1          1  387
8             1            1          1  116</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb626"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a>someidx<span class="ot">&lt;-</span><span class="dv">30</span></span>
<span id="cb626-2"><a href="#cb626-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"some real example: "</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "some real example: "</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb628"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb628-1"><a href="#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">y_real=</span>y[ subsample[[someidx]]<span class="sc">$</span>keep ])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>y_real
   0    1 
1049 1263 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb630"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb630-1"><a href="#cb630-1" aria-hidden="true" tabindex="-1"></a>tmptaxa<span class="ot">&lt;-</span> tdata</span>
<span id="cb630-2"><a href="#cb630-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmptaxa)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">colnames</span>(tmptaxa),<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb630-3"><a href="#cb630-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb630-4"><a href="#cb630-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(table,<span class="fu">c</span>( </span>
<span id="cb630-5"><a href="#cb630-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">binarize_taxa</span>(tmptaxa[subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb630-6"><a href="#cb630-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">grep</span>(<span class="fu">c</span>(<span class="st">"g__Neisseria$|g__Bergeyella$"</span>), <span class="fu">colnames</span>(tmptaxa))],</span>
<span id="cb630-7"><a href="#cb630-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">thresholds=</span><span class="fu">colMedians</span>(tmptaxa[subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb630-8"><a href="#cb630-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">grep</span>(<span class="fu">c</span>(<span class="st">"g__Neisseria$|g__Bergeyella$"</span>), <span class="fu">colnames</span>(tmptaxa))] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb630-9"><a href="#cb630-9" aria-hidden="true" tabindex="-1"></a>                  )) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">as.list</span>(),</span>
<span id="cb630-10"><a href="#cb630-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">list</span>( <span class="at">y_real=</span>y[ subsample[[someidx]]<span class="sc">$</span>keep ]) )</span>
<span id="cb630-11"><a href="#cb630-11" aria-hidden="true" tabindex="-1"></a>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  g__Bergeyella g__Neisseria y_real Freq
1             0            0      0  761
2             1            0      0    5
3             0            1      0  181
4             1            1      0  102
5             0            0      1  671
6             1            0      1    3
7             0            1      1  472
8             1            1      1  117</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb632"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb632-1"><a href="#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"IG({Y, Berg}+={Neiss})=%.3f"</span>, full_MDFSres[[someidx]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic[ </span>
<span id="cb632-2"><a href="#cb632-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">grep</span>(<span class="st">"g__Neisseria$"</span>,full_MDFSres[[someidx]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>feature_names)</span>
<span id="cb632-3"><a href="#cb632-3" aria-hidden="true" tabindex="-1"></a>                            ] ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IG({Y, Berg}+={Neiss})=94.585"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb634"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb634-1"><a href="#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ComputeMaxInfoGainsDiscrete</span>(<span class="at">data=</span><span class="fu">binarize_taxa</span>(tmptaxa[subsample[[someidx]]<span class="sc">$</span>keep,],</span>
<span id="cb634-2"><a href="#cb634-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">thresholds=</span><span class="fu">colMedians</span>(tmptaxa[subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb634-3"><a href="#cb634-3" aria-hidden="true" tabindex="-1"></a>                  ] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb634-4"><a href="#cb634-4" aria-hidden="true" tabindex="-1"></a>                         )), <span class="at">decision=</span>yp[ subsample[[someidx]]<span class="sc">$</span>keep], <span class="at">dimensions=</span><span class="dv">2</span>)[</span>
<span id="cb634-5"><a href="#cb634-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grep</span>(<span class="st">"g__Neisseria$"</span>, <span class="fu">colnames</span>(tmptaxa)),</span>
<span id="cb634-6"><a href="#cb634-6" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.61011</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb636"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb636-1"><a href="#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">212</span>)</span>
<span id="cb636-2"><a href="#cb636-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (someidx <span class="cf">in</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>,<span class="dv">5</span>,<span class="at">replace=</span><span class="cn">FALSE</span>)){</span>
<span id="cb636-3"><a href="#cb636-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"permutation #%d :"</span>, someidx))</span>
<span id="cb636-4"><a href="#cb636-4" aria-hidden="true" tabindex="-1"></a>yp<span class="ot">&lt;-</span> y</span>
<span id="cb636-5"><a href="#cb636-5" aria-hidden="true" tabindex="-1"></a>yp[] <span class="ot">&lt;-</span> y [ perm_subsample[[someidx]]<span class="sc">$</span>p_idx ]</span>
<span id="cb636-6"><a href="#cb636-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(<span class="at">y_permuted=</span>yp[ perm_subsample[[someidx]]<span class="sc">$</span>keep ]))</span>
<span id="cb636-7"><a href="#cb636-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"y_permuted vs y:"</span>)</span>
<span id="cb636-8"><a href="#cb636-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(<span class="at">y_real=</span>y[ subsample[[someidx]]<span class="sc">$</span>keep ] , <span class="at">y_permuted=</span>yp[ perm_subsample[[someidx]]<span class="sc">$</span>keep ] ))</span>
<span id="cb636-9"><a href="#cb636-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(table,<span class="fu">c</span>( </span>
<span id="cb636-10"><a href="#cb636-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">binarize_taxa</span>(tmptaxa[perm_subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb636-11"><a href="#cb636-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">grep</span>(<span class="fu">c</span>(<span class="st">"g__Neisseria$|g__Bergeyella$"</span>), <span class="fu">colnames</span>(tmptaxa))],</span>
<span id="cb636-12"><a href="#cb636-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">thresholds=</span><span class="fu">colMedians</span>(tmptaxa[perm_subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb636-13"><a href="#cb636-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">grep</span>(<span class="fu">c</span>(<span class="st">"g__Neisseria$|g__Bergeyella$"</span>),<span class="fu">colnames</span>(tmptaxa))] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb636-14"><a href="#cb636-14" aria-hidden="true" tabindex="-1"></a>                         ))<span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">as.list</span>(),</span>
<span id="cb636-15"><a href="#cb636-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">list</span>( <span class="at">y_permuted=</span>yp[ perm_subsample[[someidx]]<span class="sc">$</span>keep ]) )</span>
<span id="cb636-16"><a href="#cb636-16" aria-hidden="true" tabindex="-1"></a>)))</span>
<span id="cb636-17"><a href="#cb636-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"IG({Y, Berg}+={Neiss})=%.3f"</span>, perm_full_MDFSres[[someidx]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic[ </span>
<span id="cb636-18"><a href="#cb636-18" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">grep</span>(<span class="st">"g__Neisseria$"</span>,perm_full_MDFSres[[someidx]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>feature_names)</span>
<span id="cb636-19"><a href="#cb636-19" aria-hidden="true" tabindex="-1"></a>                            ] ))</span>
<span id="cb636-20"><a href="#cb636-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">ComputeMaxInfoGainsDiscrete</span>(<span class="at">data=</span><span class="fu">binarize_taxa</span>(tmptaxa[perm_subsample[[someidx]]<span class="sc">$</span>keep,],</span>
<span id="cb636-21"><a href="#cb636-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">thresholds=</span><span class="fu">colMedians</span>(tmptaxa[perm_subsample[[someidx]]<span class="sc">$</span>keep,</span>
<span id="cb636-22"><a href="#cb636-22" aria-hidden="true" tabindex="-1"></a>                  ] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb636-23"><a href="#cb636-23" aria-hidden="true" tabindex="-1"></a>                         )), <span class="at">decision=</span>yp[ perm_subsample[[someidx]]<span class="sc">$</span>keep], <span class="at">dimensions=</span><span class="dv">2</span>)[</span>
<span id="cb636-24"><a href="#cb636-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grep</span>(<span class="st">"g__Neisseria$"</span>, <span class="fu">colnames</span>(tmptaxa)),</span>
<span id="cb636-25"><a href="#cb636-25" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb636-26"><a href="#cb636-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "permutation #462 :"
y_permuted
   0    1 
1011 1301 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 470 592
     1 541 709
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  630
2             1            0          0    8
3             0            1          0  289
4             1            1          0   84
5             0            0          1  777
6             1            0          1    3
7             0            1          1  391
8             1            1          1  130
[1] "IG({Y, Berg}+={Neiss})=105.361"
[1] 9.759277
[1] "permutation #72 :"
y_permuted
   0    1 
 999 1313 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 455 616
     1 544 697
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  601
2             1            0          0    2
3             0            1          0  281
4             1            1          0  115
5             0            0          1  817
6             1            0          1   11
7             0            1          1  384
8             1            1          1  101
[1] "IG({Y, Berg}+={Neiss})=108.734"
[1] 9.6521
[1] "permutation #51 :"
y_permuted
   0    1 
1003 1309 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 482 599
     1 521 710
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  634
2             1            0          0    5
3             0            1          0  287
4             1            1          0   77
5             0            0          1  805
6             1            0          1    3
7             0            1          1  365
8             1            1          1  136
[1] "IG({Y, Berg}+={Neiss})=94.260"
[1] 10.61475
[1] "permutation #336 :"
y_permuted
   0    1 
1034 1278 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 458 592
     1 576 686
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  635
2             1            0          0    7
3             0            1          0  294
4             1            1          0   98
5             0            0          1  798
6             1            0          1    4
7             0            1          1  353
8             1            1          1  123
[1] "IG({Y, Berg}+={Neiss})=97.267"
[1] 7.423828
[1] "permutation #481 :"
y_permuted
   0    1 
1020 1292 
[1] "y_permuted vs y:"
      y_permuted
y_real   0   1
     0 447 632
     1 573 660
  g__Bergeyella g__Neisseria y_permuted Freq
1             0            0          0  632
2             1            0          0    6
3             0            1          0  277
4             1            1          0  105
5             0            0          1  782
6             1            0          1    7
7             0            1          1  387
8             1            1          1  116
[1] "IG({Y, Berg}+={Neiss})=111.753"
[1] 8.273193</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb638"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb638-1"><a href="#cb638-1" aria-hidden="true" tabindex="-1"></a>eFPR<span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">md1D0=</span><span class="fu">vector</span>(), </span>
<span id="cb638-2"><a href="#cb638-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">md1Dm=</span><span class="fu">vector</span>(),</span>
<span id="cb638-3"><a href="#cb638-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">md2Dm=</span><span class="fu">vector</span>(),</span>
<span id="cb638-4"><a href="#cb638-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">md2D0=</span><span class="fu">vector</span>(),</span>
<span id="cb638-5"><a href="#cb638-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">u=</span><span class="fu">vector</span>())</span>
<span id="cb638-6"><a href="#cb638-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_perm) {</span>
<span id="cb638-7"><a href="#cb638-7" aria-hidden="true" tabindex="-1"></a>eFPR[[<span class="st">'md1D0'</span>]][[j]]<span class="ot">=</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_1D0<span class="sc">$</span>rel_set)<span class="sc">/</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_1D0<span class="sc">$</span>feature_names)</span>
<span id="cb638-8"><a href="#cb638-8" aria-hidden="true" tabindex="-1"></a>eFPR[[<span class="st">'md1Dm'</span>]][[j]]<span class="ot">=</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_1Dm<span class="sc">$</span>rel_set)<span class="sc">/</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_1Dm<span class="sc">$</span>feature_names)</span>
<span id="cb638-9"><a href="#cb638-9" aria-hidden="true" tabindex="-1"></a>eFPR[[<span class="st">'md2D0'</span>]][[j]]<span class="ot">=</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_2D0<span class="sc">$</span>rel_set)<span class="sc">/</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_2D0<span class="sc">$</span>feature_names)</span>
<span id="cb638-10"><a href="#cb638-10" aria-hidden="true" tabindex="-1"></a>eFPR[[<span class="st">'md2Dm'</span>]][[j]]<span class="ot">=</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>rel_set)<span class="sc">/</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>feature_names)</span>
<span id="cb638-11"><a href="#cb638-11" aria-hidden="true" tabindex="-1"></a>eFPR[[<span class="st">'u'</span>]][[j]]<span class="ot">=</span><span class="fu">length</span>(perm_full_Ures[[j]]<span class="sc">$</span>rel_set)<span class="sc">/</span><span class="fu">length</span>(perm_full_MDFSres[[j]]<span class="sc">$</span>res_1D0<span class="sc">$</span>feature_names) <span class="co">#same filtering on sparsity in U_test</span></span>
<span id="cb638-12"><a href="#cb638-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb639"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"empirical_FPR.pdf"</span>)</span>
<span id="cb639-2"><a href="#cb639-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(eFPR))</span>
<span id="cb639-3"><a href="#cb639-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(eFPR[[name]], <span class="at">main=</span>name)</span>
<span id="cb639-4"><a href="#cb639-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb641"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a>max_permIG<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">IG1D=</span> <span class="fu">lapply</span>(perm_full_MDFSres, <span class="cf">function</span>(x) <span class="fu">max</span>(<span class="fu">max</span>(x<span class="sc">$</span>res_1D0<span class="sc">$</span>statistic), <span class="fu">max</span>(x<span class="sc">$</span>res_1Dm<span class="sc">$</span>statistic)))<span class="sc">|&gt;</span><span class="fu">unlist</span>(),</span>
<span id="cb641-2"><a href="#cb641-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">IG2D=</span> <span class="fu">lapply</span>(perm_full_MDFSres, <span class="cf">function</span>(x) <span class="fu">max</span>(<span class="fu">max</span>(x<span class="sc">$</span>res_2D0<span class="sc">$</span>statistic), <span class="fu">max</span>(x<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic)))<span class="sc">|&gt;</span><span class="fu">unlist</span>(),</span>
<span id="cb641-3"><a href="#cb641-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">IG_increase=</span> <span class="fu">lapply</span>(perm_full_MDFSres, <span class="cf">function</span>(x) </span>
<span id="cb641-4"><a href="#cb641-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">max</span>(<span class="fu">max</span>(x<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic<span class="sc">-</span> x<span class="sc">$</span>res_1Dm<span class="sc">$</span>statistic),</span>
<span id="cb641-5"><a href="#cb641-5" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">max</span>(x<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic<span class="sc">-</span> x<span class="sc">$</span>res_1Dm<span class="sc">$</span>statistic)</span>
<span id="cb641-6"><a href="#cb641-6" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb641-7"><a href="#cb641-7" aria-hidden="true" tabindex="-1"></a>                        )<span class="sc">|&gt;</span><span class="fu">unlist</span>()</span>
<span id="cb641-8"><a href="#cb641-8" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb642"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb642-1"><a href="#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"max_perm_IG.pdf"</span>)</span>
<span id="cb642-2"><a href="#cb642-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(max_permIG))</span>
<span id="cb642-3"><a href="#cb642-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">hist</span>(max_permIG[[name]],<span class="at">main=</span><span class="fu">sprintf</span>(<span class="st">"maximum %s - distribution over permutations"</span>, name))</span>
<span id="cb642-4"><a href="#cb642-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb644"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb644-1"><a href="#cb644-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Reduce</span>(rbind, </span>
<span id="cb644-2"><a href="#cb644-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">lapply</span>(perm_subsample, <span class="cf">function</span>(x)</span>
<span id="cb644-3"><a href="#cb644-3" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>p_idx  )</span>
<span id="cb644-4"><a href="#cb644-4" aria-hidden="true" tabindex="-1"></a>       )<span class="ot">-&gt;</span> permutations</span>
<span id="cb644-5"><a href="#cb644-5" aria-hidden="true" tabindex="-1"></a>permutations<span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(permutations)</span>
<span id="cb644-6"><a href="#cb644-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(permutations[<span class="sc">!</span><span class="fu">duplicated</span>(permutations),])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 500</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb646"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb646-1"><a href="#cb646-1" aria-hidden="true" tabindex="-1"></a>named_IG<span class="ot">&lt;-</span> <span class="cf">function</span>(mdfs_result){</span>
<span id="cb646-2"><a href="#cb646-2" aria-hidden="true" tabindex="-1"></a> ig<span class="ot">&lt;-</span>mdfs_result<span class="sc">$</span>statistic</span>
<span id="cb646-3"><a href="#cb646-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">names</span>(ig)<span class="ot">&lt;-</span>mdfs_result<span class="sc">$</span>feature_names</span>
<span id="cb646-4"><a href="#cb646-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb646-5"><a href="#cb646-5" aria-hidden="true" tabindex="-1"></a>nS_gt_thr<span class="ot">&lt;-</span> <span class="cf">function</span>(thr, S){</span>
<span id="cb646-6"><a href="#cb646-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">length</span>(S) <span class="sc">-</span> <span class="fu">findInterval</span>(<span class="fu">sort</span>(thr),<span class="fu">sort</span>(S))</span>
<span id="cb646-7"><a href="#cb646-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb646-8"><a href="#cb646-8" aria-hidden="true" tabindex="-1"></a>mean_subsampleIG1D<span class="ot">&lt;-</span><span class="fu">colMeans</span>(IG1D)</span>
<span id="cb646-9"><a href="#cb646-9" aria-hidden="true" tabindex="-1"></a>mean_subsampleIG2D<span class="ot">&lt;-</span><span class="fu">colMeans</span>(IG2D)</span>
<span id="cb646-10"><a href="#cb646-10" aria-hidden="true" tabindex="-1"></a>meanIG1Dorder<span class="ot">&lt;-</span><span class="fu">order</span>(mean_subsampleIG1D)</span>
<span id="cb646-11"><a href="#cb646-11" aria-hidden="true" tabindex="-1"></a>meanIG2Dorder<span class="ot">&lt;-</span><span class="fu">order</span>(mean_subsampleIG2D)</span>
<span id="cb646-12"><a href="#cb646-12" aria-hidden="true" tabindex="-1"></a>n_perm_gt_IG1D0<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="at">nrow=</span>n_perm, <span class="at">ncol=</span><span class="fu">length</span>(mean_subsampleIG1D))</span>
<span id="cb646-13"><a href="#cb646-13" aria-hidden="true" tabindex="-1"></a>n_perm_gt_IG1Dm<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="at">nrow=</span>n_perm, <span class="at">ncol=</span><span class="fu">length</span>(mean_subsampleIG1D))</span>
<span id="cb646-14"><a href="#cb646-14" aria-hidden="true" tabindex="-1"></a>n_perm_gt_IG2D0<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="at">nrow=</span>n_perm, <span class="at">ncol=</span><span class="fu">length</span>(mean_subsampleIG2D))</span>
<span id="cb646-15"><a href="#cb646-15" aria-hidden="true" tabindex="-1"></a>n_perm_gt_IG2Dm<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="at">nrow=</span>n_perm, <span class="at">ncol=</span><span class="fu">length</span>(mean_subsampleIG2D))</span>
<span id="cb646-16"><a href="#cb646-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_perm){</span>
<span id="cb646-17"><a href="#cb646-17" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (j<span class="sc">%%</span><span class="dv">50</span><span class="sc">==</span><span class="dv">0</span>) <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"%d /%d"</span>,j,n_perm))</span>
<span id="cb646-18"><a href="#cb646-18" aria-hidden="true" tabindex="-1"></a> n_perm_gt_IG1D0[j,]<span class="ot">&lt;-</span> <span class="fu">nS_gt_thr</span>(<span class="at">thr=</span>mean_subsampleIG1D, <span class="at">S=</span>perm_full_MDFSres[[j]]<span class="sc">$</span>res_1D0<span class="sc">$</span>statistic)</span>
<span id="cb646-19"><a href="#cb646-19" aria-hidden="true" tabindex="-1"></a> n_perm_gt_IG1Dm[j,]<span class="ot">&lt;-</span> <span class="fu">nS_gt_thr</span>(<span class="at">thr=</span>mean_subsampleIG1D, <span class="at">S=</span>perm_full_MDFSres[[j]]<span class="sc">$</span>res_1Dm<span class="sc">$</span>statistic)</span>
<span id="cb646-20"><a href="#cb646-20" aria-hidden="true" tabindex="-1"></a> n_perm_gt_IG2D0[j,]<span class="ot">&lt;-</span> <span class="fu">nS_gt_thr</span>(<span class="at">thr=</span>mean_subsampleIG2D, <span class="at">S=</span>perm_full_MDFSres[[j]]<span class="sc">$</span>res_2D0<span class="sc">$</span>statistic)</span>
<span id="cb646-21"><a href="#cb646-21" aria-hidden="true" tabindex="-1"></a> n_perm_gt_IG2Dm[j,]<span class="ot">&lt;-</span> <span class="fu">nS_gt_thr</span>(<span class="at">thr=</span>mean_subsampleIG2D, <span class="at">S=</span>perm_full_MDFSres[[j]]<span class="sc">$</span>res_2Dm<span class="sc">$</span>statistic)</span>
<span id="cb646-22"><a href="#cb646-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>50 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>100 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>150 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>200 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>250 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>300 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>350 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>400 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>450 /500</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>500 /500</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb657"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb657-1"><a href="#cb657-1" aria-hidden="true" tabindex="-1"></a>plot_survival_function<span class="ot">&lt;-</span> <span class="cf">function</span>( Y, <span class="co">#n_reps x length(x)</span></span>
<span id="cb657-2"><a href="#cb657-2" aria-hidden="true" tabindex="-1"></a>               x, critical_x, <span class="at">crit_x_annot=</span><span class="cn">NULL</span>,</span>
<span id="cb657-3"><a href="#cb657-3" aria-hidden="true" tabindex="-1"></a>               ...){</span>
<span id="cb657-4"><a href="#cb657-4" aria-hidden="true" tabindex="-1"></a> m<span class="ot">&lt;-</span> <span class="fu">colMeans</span>(Y)</span>
<span id="cb657-5"><a href="#cb657-5" aria-hidden="true" tabindex="-1"></a> sd<span class="ot">&lt;-</span> <span class="fu">apply</span>(Y,<span class="dv">2</span>,sd)</span>
<span id="cb657-6"><a href="#cb657-6" aria-hidden="true" tabindex="-1"></a> upper<span class="ot">&lt;-</span> m<span class="sc">+</span> sd</span>
<span id="cb657-7"><a href="#cb657-7" aria-hidden="true" tabindex="-1"></a> lower<span class="ot">&lt;-</span> m <span class="sc">-</span> sd</span>
<span id="cb657-8"><a href="#cb657-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-9"><a href="#cb657-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(x, m, <span class="at">type=</span><span class="st">"b"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"black"</span>,</span>
<span id="cb657-10"><a href="#cb657-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylim=</span> <span class="fu">range</span>(Y),</span>
<span id="cb657-11"><a href="#cb657-11" aria-hidden="true" tabindex="-1"></a>      ...)</span>
<span id="cb657-12"><a href="#cb657-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">polygon</span>(<span class="fu">c</span>(x,<span class="fu">rev</span>(x)),</span>
<span id="cb657-13"><a href="#cb657-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">c</span>(upper,<span class="fu">rev</span>(lower)),</span>
<span id="cb657-14"><a href="#cb657-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.25</span>))</span>
<span id="cb657-15"><a href="#cb657-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">abline</span>(<span class="at">v=</span>critical_x, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb657-16"><a href="#cb657-16" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(crit_x_annot)) <span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">legend=</span>crit_x_annot)</span>
<span id="cb657-17"><a href="#cb657-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb657-18"><a href="#cb657-18" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"n_perm_IG_gt_threshold.pdf"</span>)</span>
<span id="cb657-19"><a href="#cb657-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_survival_function</span>( n_perm_gt_IG1D0, <span class="fu">sort</span>(mean_subsampleIG1D), </span>
<span id="cb657-20"><a href="#cb657-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">critical_x=</span> <span class="fu">min</span>(mean_subsampleIG1D[ fs_df<span class="sc">$</span>rel_1D <span class="sc">&gt;=</span> <span class="dv">450</span> ]),</span>
<span id="cb657-21"><a href="#cb657-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">crit_x_annot=</span> <span class="st">'min IG1D </span><span class="sc">\n</span><span class="st"> (confirmed)'</span>,</span>
<span id="cb657-22"><a href="#cb657-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">log=</span><span class="st">'x'</span>, </span>
<span id="cb657-23"><a href="#cb657-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="st">'# variables with perm_IG &gt; IG[i] </span><span class="sc">\n</span><span class="st"> 1D0'</span>,</span>
<span id="cb657-24"><a href="#cb657-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">'IG[i] (jackknife mean of confirmed variable number i )'</span>,</span>
<span id="cb657-25"><a href="#cb657-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">ylab=</span><span class="st">'# perm_IG &gt; IG[i]'</span>)</span>
<span id="cb657-26"><a href="#cb657-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-27"><a href="#cb657-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_survival_function</span>( n_perm_gt_IG1Dm, <span class="fu">sort</span>(mean_subsampleIG1D), <span class="at">log=</span><span class="st">'x'</span>, </span>
<span id="cb657-28"><a href="#cb657-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">critical_x=</span> <span class="fu">min</span>(mean_subsampleIG1D[ fs_df<span class="sc">$</span>rel_1D <span class="sc">&gt;=</span> <span class="dv">450</span> ]),</span>
<span id="cb657-29"><a href="#cb657-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">crit_x_annot=</span> <span class="st">'min IG1D </span><span class="sc">\n</span><span class="st"> (confirmed)'</span>,</span>
<span id="cb657-30"><a href="#cb657-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="st">'# variables with perm_IG &gt; IG[i] </span><span class="sc">\n</span><span class="st"> 1Dm'</span>,</span>
<span id="cb657-31"><a href="#cb657-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">'IG[i] (jackknife mean of confirmed variable number i )'</span>,</span>
<span id="cb657-32"><a href="#cb657-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">ylab=</span><span class="st">'# perm_IG &gt; IG[i]'</span>)</span>
<span id="cb657-33"><a href="#cb657-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-34"><a href="#cb657-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_survival_function</span>( n_perm_gt_IG2D0, <span class="fu">sort</span>(mean_subsampleIG2D), <span class="at">log=</span><span class="st">'x'</span>, </span>
<span id="cb657-35"><a href="#cb657-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">critical_x=</span> <span class="fu">min</span>(mean_subsampleIG2D[ fs_df<span class="sc">$</span>rel_2D <span class="sc">&gt;=</span> <span class="dv">450</span> ]),</span>
<span id="cb657-36"><a href="#cb657-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">crit_x_annot=</span> <span class="st">'min IG2D </span><span class="sc">\n</span><span class="st"> (confirmed)'</span>,</span>
<span id="cb657-37"><a href="#cb657-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="st">'# variables with perm_IG &gt; IG[i] </span><span class="sc">\n</span><span class="st"> 2D0'</span>,</span>
<span id="cb657-38"><a href="#cb657-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">'IG[i] (jackknife mean of confirmed variable number i )'</span>,</span>
<span id="cb657-39"><a href="#cb657-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">ylab=</span><span class="st">'# perm_IG &gt; IG[i]'</span>)</span>
<span id="cb657-40"><a href="#cb657-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-41"><a href="#cb657-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_survival_function</span>( n_perm_gt_IG2Dm, <span class="fu">sort</span>(mean_subsampleIG2D), <span class="at">log=</span><span class="st">'x'</span>, </span>
<span id="cb657-42"><a href="#cb657-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">critical_x=</span> <span class="fu">min</span>(mean_subsampleIG2D[ fs_df<span class="sc">$</span>rel_2D <span class="sc">&gt;=</span> <span class="dv">450</span> ]),</span>
<span id="cb657-43"><a href="#cb657-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">crit_x_annot=</span> <span class="st">'min IG2D </span><span class="sc">\n</span><span class="st"> (confirmed)'</span>,</span>
<span id="cb657-44"><a href="#cb657-44" aria-hidden="true" tabindex="-1"></a>               <span class="at">main=</span><span class="st">'# variables with perm_IG &gt; IG[i] </span><span class="sc">\n</span><span class="st"> 2Dm'</span>,</span>
<span id="cb657-45"><a href="#cb657-45" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab=</span><span class="st">'IG[i] (jackknife mean of confirmed variable number i )'</span>,</span>
<span id="cb657-46"><a href="#cb657-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">ylab=</span><span class="st">'# perm_IG &gt; IG[i]'</span>)</span>
<span id="cb657-47"><a href="#cb657-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb659"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"res_1Dm"</span>, <span class="st">"res_2Dm"</span>, <span class="st">"res_1D0"</span>, <span class="st">"res_2D0"</span>)<span class="ot">-&gt;</span> variant_names</span>
<span id="cb659-2"><a href="#cb659-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-3"><a href="#cb659-3" aria-hidden="true" tabindex="-1"></a>perm_IGranks<span class="ot">&lt;-</span> <span class="fu">lapply</span>(variant_names,</span>
<span id="cb659-4"><a href="#cb659-4" aria-hidden="true" tabindex="-1"></a>              <span class="cf">function</span>(vn){</span>
<span id="cb659-5"><a href="#cb659-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">lapply</span>(perm_full_MDFSres, <span class="cf">function</span>(x)</span>
<span id="cb659-6"><a href="#cb659-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">data.frame</span>(<span class="at">taxon=</span>x[[vn]]<span class="sc">$</span>feature_names,</span>
<span id="cb659-7"><a href="#cb659-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">IG=</span>x[[vn]]<span class="sc">$</span>statistic) </span>
<span id="cb659-8"><a href="#cb659-8" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb659-9"><a href="#cb659-9" aria-hidden="true" tabindex="-1"></a>              })</span>
<span id="cb659-10"><a href="#cb659-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-11"><a href="#cb659-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(perm_IGranks)<span class="ot">&lt;-</span>variant_names</span>
<span id="cb659-12"><a href="#cb659-12" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"perm_IG_ranks.pdf"</span>)</span>
<span id="cb659-13"><a href="#cb659-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (vn <span class="cf">in</span> variant_names){</span>
<span id="cb659-14"><a href="#cb659-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fu">rank</span>(perm_IGranks[[vn]][[<span class="dv">1</span>]]<span class="sc">$</span>IG),</span>
<span id="cb659-15"><a href="#cb659-15" aria-hidden="true" tabindex="-1"></a>         perm_IGranks[[vn]][[<span class="dv">1</span>]]<span class="sc">$</span>IG,</span>
<span id="cb659-16"><a href="#cb659-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.3</span>,<span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.3</span>),</span>
<span id="cb659-17"><a href="#cb659-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">main=</span><span class="fu">sprintf</span>(<span class="st">"%s - distribution of k-th largest IG over permuations"</span>,vn),</span>
<span id="cb659-18"><a href="#cb659-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">"rank(IG_perm)"</span>, <span class="at">ylab=</span><span class="st">"IG_perm"</span>)</span>
<span id="cb659-19"><a href="#cb659-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(perm_IGranks[[vn]]))</span>
<span id="cb659-20"><a href="#cb659-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">points</span>(<span class="fu">rank</span>(perm_IGranks[[vn]][[j]]<span class="sc">$</span>IG),</span>
<span id="cb659-21"><a href="#cb659-21" aria-hidden="true" tabindex="-1"></a>            perm_IGranks[[vn]][[j]]<span class="sc">$</span>IG,</span>
<span id="cb659-22"><a href="#cb659-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.3</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.3</span>))</span>
<span id="cb659-23"><a href="#cb659-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (vn <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"res_2D0"</span>, <span class="st">"res_2Dm"</span>)){</span>
<span id="cb659-24"><a href="#cb659-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h=</span> <span class="fu">min</span>(mean_subsampleIG2D[ fs_df<span class="sc">$</span>rel_2D <span class="sc">&gt;=</span> <span class="dv">450</span> ]), <span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb659-25"><a href="#cb659-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">legend=</span><span class="st">"min 2D IG confirmed </span><span class="sc">\n</span><span class="st"> (jackknife mean)"</span>)</span>
<span id="cb659-26"><a href="#cb659-26" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb659-27"><a href="#cb659-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">h=</span> <span class="fu">min</span>(mean_subsampleIG1D[ fs_df<span class="sc">$</span>rel_1D <span class="sc">&gt;=</span> <span class="dv">450</span> ]), <span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb659-28"><a href="#cb659-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">legend=</span><span class="st">"min 1D IG confirmed </span><span class="sc">\n</span><span class="st"> (jackknife mean)"</span>)</span>
<span id="cb659-29"><a href="#cb659-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb659-30"><a href="#cb659-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb659-31"><a href="#cb659-31" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb661"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb661-1"><a href="#cb661-1" aria-hidden="true" tabindex="-1"></a>all_the_taxa_permTest<span class="ot">&lt;-</span><span class="fu">Reduce</span>(union,<span class="fu">lapply</span>(perm_IGranks, <span class="cf">function</span>(x) <span class="fu">Reduce</span>(union,<span class="fu">lapply</span>(x, <span class="cf">function</span>(y) y<span class="sc">$</span>taxon))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb662"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb662-1"><a href="#cb662-1" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span><span class="dv">35</span></span>
<span id="cb662-2"><a href="#cb662-2" aria-hidden="true" tabindex="-1"></a>F<span class="ot">&lt;-</span><span class="fu">lapply</span>(variant_names, <span class="cf">function</span>(x) <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span><span class="fu">length</span>(all_the_taxa_permTest),</span>
<span id="cb662-3"><a href="#cb662-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ncol=</span>k))</span>
<span id="cb662-4"><a href="#cb662-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(F)<span class="ot">&lt;-</span>variant_names</span>
<span id="cb662-5"><a href="#cb662-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(F)) <span class="fu">rownames</span>(F[[i]])<span class="ot">&lt;-</span>all_the_taxa_permTest</span>
<span id="cb662-6"><a href="#cb662-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (vn <span class="cf">in</span> variant_names) <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_perm){</span>
<span id="cb662-7"><a href="#cb662-7" aria-hidden="true" tabindex="-1"></a>    top_k_idx<span class="ot">&lt;-</span> <span class="fu">order</span>(perm_IGranks[[vn]][[j]]<span class="sc">$</span>IG, <span class="at">decreasing=</span><span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span>k]</span>
<span id="cb662-8"><a href="#cb662-8" aria-hidden="true" tabindex="-1"></a>    top_k_taxa<span class="ot">&lt;-</span>perm_IGranks[[vn]][[j]]<span class="sc">$</span>taxon[top_k_idx]</span>
<span id="cb662-9"><a href="#cb662-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k_i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb662-10"><a href="#cb662-10" aria-hidden="true" tabindex="-1"></a>    F[[vn]][ top_k_taxa[[k_i]],k_i   ]<span class="ot">=</span>   F[[vn]][ top_k_taxa[[k_i]],k_i   ] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb662-11"><a href="#cb662-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb662-12"><a href="#cb662-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb663"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb663-1"><a href="#cb663-1" aria-hidden="true" tabindex="-1"></a>vn<span class="ot">&lt;-</span> variant_names[[<span class="dv">1</span>]]</span>
<span id="cb663-2"><a href="#cb663-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"rank_frequency_perm.pdf"</span>, <span class="at">width=</span><span class="dv">14</span>,<span class="at">height=</span><span class="dv">7</span>)</span>
<span id="cb663-3"><a href="#cb663-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (vn <span class="cf">in</span> variant_names){</span>
<span id="cb663-4"><a href="#cb663-4" aria-hidden="true" tabindex="-1"></a>F_v<span class="ot">&lt;-</span>   F[[vn]][ <span class="fu">order</span>(<span class="sc">-</span><span class="fu">rowSums</span>(F[[vn]])), ]</span>
<span id="cb663-5"><a href="#cb663-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(F_v)<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">rownames</span>(F_v),<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb663-6"><a href="#cb663-6" aria-hidden="true" tabindex="-1"></a>F_v<span class="ot">&lt;-</span> F_v[<span class="dv">1</span><span class="sc">:</span><span class="dv">35</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb663-7"><a href="#cb663-7" aria-hidden="true" tabindex="-1"></a>F_v_flat<span class="ot">&lt;-</span><span class="fu">melt</span>(F_v)</span>
<span id="cb663-8"><a href="#cb663-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(F_v_flat)<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"taxon"</span>, <span class="st">"top_k"</span>,<span class="st">"freq"</span>)</span>
<span id="cb663-9"><a href="#cb663-9" aria-hidden="true" tabindex="-1"></a>myplot<span class="ot">&lt;-</span><span class="fu">ggplot</span>(F_v_flat, <span class="fu">aes</span>(<span class="at">x=</span> taxon, <span class="at">y=</span>top_k, <span class="at">fill=</span>freq)) <span class="sc">+</span> <span class="fu">geom_tile</span>()<span class="sc">+</span></span>
<span id="cb663-10"><a href="#cb663-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggtitle</span>(<span class="fu">sprintf</span>(<span class="st">"%s - frequency of having top_k highest IG in permuatations"</span>,vn))<span class="sc">+</span></span>
<span id="cb663-11"><a href="#cb663-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb663-12"><a href="#cb663-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> freq), <span class="at">color =</span> <span class="st">"pink"</span>)</span>
<span id="cb663-13"><a href="#cb663-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ggsave(sprintf("%s_rankFreq_perm.pdf",vn),myplot,width=14,height=7,units="in")</span></span>
<span id="cb663-14"><a href="#cb663-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(myplot)</span>
<span id="cb663-15"><a href="#cb663-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb663-16"><a href="#cb663-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb665"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb665-1"><a href="#cb665-1" aria-hidden="true" tabindex="-1"></a>plausible_perm_IG<span class="ot">&lt;-</span> <span class="fu">lapply</span>(variant_names, <span class="cf">function</span>(vn)</span>
<span id="cb665-2"><a href="#cb665-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span>n_perm, <span class="at">ncol=</span><span class="fu">length</span>(plausible)))</span>
<span id="cb665-3"><a href="#cb665-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plausible_perm_IG)<span class="ot">&lt;-</span> variant_names</span>
<span id="cb665-4"><a href="#cb665-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (vn <span class="cf">in</span> variant_names) <span class="fu">colnames</span>(plausible_perm_IG[[vn]])<span class="ot">&lt;-</span> plausible</span>
<span id="cb665-5"><a href="#cb665-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (vn <span class="cf">in</span> variant_names) <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_perm){</span>
<span id="cb665-6"><a href="#cb665-6" aria-hidden="true" tabindex="-1"></a>    perm_IGranks[[vn]][[j]]<span class="sc">$</span>IG<span class="ot">-&gt;</span> temp</span>
<span id="cb665-7"><a href="#cb665-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(temp)<span class="ot">&lt;-</span> perm_IGranks[[vn]][[j]]<span class="sc">$</span>taxon</span>
<span id="cb665-8"><a href="#cb665-8" aria-hidden="true" tabindex="-1"></a>    plausible_perm_IG[[vn]][j, ]<span class="ot">=</span> temp[ plausible ]</span>
<span id="cb665-9"><a href="#cb665-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb666"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb666-1"><a href="#cb666-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (vn <span class="cf">in</span> variant_names) <span class="fu">colnames</span>(plausible_perm_IG[[vn]])<span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(plausible,<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>), <span class="cf">function</span>(x) x[[<span class="fu">length</span>(x)]])</span>
<span id="cb666-2"><a href="#cb666-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-3"><a href="#cb666-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"IGperm_histograms_plausible.pdf"</span>)</span>
<span id="cb666-4"><a href="#cb666-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-5"><a href="#cb666-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ptaxa <span class="cf">in</span> <span class="fu">colnames</span>(plausible_perm_IG[[<span class="dv">1</span>]]))</span>
<span id="cb666-6"><a href="#cb666-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (vn <span class="cf">in</span> variant_names)</span>
<span id="cb666-7"><a href="#cb666-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hist</span>(plausible_perm_IG[[vn]][,ptaxa], <span class="at">main=</span> <span class="fu">sprintf</span>(<span class="st">"perm_IG of %s - %s"</span>, ptaxa, vn))</span>
<span id="cb666-8"><a href="#cb666-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-9"><a href="#cb666-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>